<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converse com Maria - M√£e de Jesus Cristo</title>
    <meta name="description" content="Converse com Maria, M√£e de Jesus Cristo. Receba conforto espiritual baseado nas Sagradas Escrituras.">
    <meta name="theme-color" content="#d4a574">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Maria">
    
    <!-- Firebase SDK (carregar primeiro!) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Config e Auth UI -->
    <script src="firebase-config.js" defer></script>
    <script src="firebase-auth-ui.js" defer></script>
    
    <!-- Scripts de funcionalidades -->
    <script src="filtro.js?v=3" defer></script>
    <script src="notifications.js?v=2" defer></script>
    <script src="calendario.js?v=2" defer></script>
    <script src="terco.js?v=3" defer></script>
    <script src="velas.js?v=5" defer></script>
    <script src="mural.js?v=4" defer></script>
    <script src="premium.js?v=2" defer></script>
    <script src="estatisticas.js?v=3" defer></script>
    <script src="conquistas.js?v=1" defer></script>
    <script src="aparicoes.js?v=1" defer></script>
    <script src="temas.js?v=2" defer></script>
    <script src="musicas.js?v=1" defer></script>
    <script src="limite.js?v=1" defer></script>
    
    <!-- Scripts de Monetiza√ß√£o -->
    <script src="pagamento.js?v=1" defer></script>
    <script src="admob.js?v=1" defer></script>
    <script src="avaliacao.js?v=1" defer></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .font-serif { font-family: 'Crimson Text', Georgia, serif; }
        .font-cursive { font-family: 'Great Vibes', cursive; }
        body { font-family: 'Crimson Text', Georgia, serif; }
        
        /* SPLASH SCREEN */
        #splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #0a1f0a;
            transition: opacity 1.5s ease-out;
            overflow: hidden;
        }
        
        #splash.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Imagem de Maria */
        .maria-image-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .maria-image {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            animation: imageReveal 2s ease-out forwards;
            opacity: 0;
        }
        
        @keyframes imageReveal {
            0% { opacity: 0; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Overlay com gradiente suave */
        .splash-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(10, 31, 10, 0.3) 0%,
                rgba(10, 31, 10, 0) 30%,
                rgba(10, 31, 10, 0) 70%,
                rgba(10, 31, 10, 0.6) 100%
            );
            pointer-events: none;
        }
        
        /* Part√≠culas de luz (como na imagem) */
        .light-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            animation: particleFloat 4s ease-in-out infinite;
        }
        
        @keyframes particleFloat {
            0%, 100% { opacity: 0.4; transform: translateY(0) scale(1); }
            50% { opacity: 0.8; transform: translateY(-20px) scale(1.2); }
        }
        
        /* Brilho celestial do topo */
        .celestial-glow {
            position: absolute;
            top: -20%;
            left: 50%;
            transform: translateX(-50%);
            width: 150%;
            height: 60%;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            animation: celestialPulse 3s ease-in-out infinite;
        }
        
        @keyframes celestialPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        
        /* Texto do splash - posicionado na parte inferior */
        .splash-text {
            position: absolute;
            bottom: 8%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
        }
        
        .splash-title {
            animation: titleFade 2s ease-out 0.5s forwards;
            opacity: 0;
            text-shadow: 0 2px 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,215,0,0.3);
        }
        
        @keyframes titleFade {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .splash-subtitle {
            animation: subtitleFade 2s ease-out 1s forwards;
            opacity: 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        
        @keyframes subtitleFade {
            0% { opacity: 0; }
            100% { opacity: 0.9; }
        }
        
        /* ==================== TELA DE DEPOIMENTOS ==================== */
        #testimonials {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9998;
            background: linear-gradient(165deg, #1a0a0a 0%, #2d1810 30%, #1f0f0a 60%, #0d0505 100%);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        #testimonials.hidden {
            display: none;
        }
        
        /* Container dos cards com scroll autom√°tico */
        .testimonials-scroll {
            flex: 1;
            overflow: hidden;
            position: relative;
            mask-image: linear-gradient(to bottom, transparent 0%, black 8%, black 75%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 8%, black 75%, transparent 100%);
        }
        
        .testimonials-track {
            animation: scrollTestimonials 35s linear infinite;
        }
        
        @keyframes scrollTestimonials {
            0% { transform: translateY(0); }
            100% { transform: translateY(-50%); }
        }
        
        /* Card de depoimento */
        .testimonial-card {
            background: linear-gradient(135deg, rgba(50, 30, 20, 0.9) 0%, rgba(35, 20, 15, 0.95) 100%);
            border: 1px solid rgba(180, 83, 9, 0.3);
            border-radius: 16px;
            padding: 20px 24px;
            margin: 12px 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
        }
        
        .testimonial-name {
            font-weight: 700;
            color: #f5f5f5;
            font-size: 1.1rem;
            margin-bottom: 6px;
        }
        
        .testimonial-stars {
            display: flex;
            gap: 2px;
            margin-bottom: 10px;
        }
        
        .star-icon {
            color: #f59e0b;
            font-size: 1.4rem;
        }
        
        .testimonial-text {
            color: #d1d5db;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* √Årea inferior fixa */
        .testimonials-footer {
            background: linear-gradient(to top, #0d0505 0%, #0d0505 60%, transparent 100%);
            padding: 30px 24px 20px;
            position: relative;
        }
        
        .testimonials-cta {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 20px;
        }
        
        .testimonials-cta span {
            color: #fbbf24;
        }
        
        .btn-continuar {
            width: 100%;
            background: #fefefe;
            color: #1a0a0a;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 16px 32px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255,255,255,0.2);
        }
        
        .btn-continuar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,255,255,0.3);
        }
        
        .btn-continuar:active {
            transform: translateY(0);
        }
        
        /* Outras anima√ß√µes existentes */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25%); } }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        
        .pergaminho-bg {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23fef3c7' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .typing-indicator span { animation: bounce 1s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        .btn-audio { transition: all 0.3s ease; }
        .btn-audio:hover { transform: scale(1.05); }
        .btn-audio.playing { background-color: #fbbf24; }
        .btn-audio.loading { opacity: 0.7; cursor: wait; }
        
        @keyframes soundWave {
            0%, 100% { height: 4px; }
            50% { height: 16px; }
        }
        .sound-wave span {
            display: inline-block;
            width: 3px;
            margin: 0 1px;
            background-color: #b45309;
            border-radius: 2px;
            animation: soundWave 0.5s infinite;
        }
        .sound-wave span:nth-child(1) { animation-delay: 0s; }
        .sound-wave span:nth-child(2) { animation-delay: 0.1s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }
    

        /* ==================== ONBOARDING PREMIUM (Gold Ritual) ==================== */
        .onb-bg{
            position:absolute; inset:0;
            background:
                radial-gradient(1200px 600px at 50% -10%, rgba(255,224,153,.9), rgba(255,224,153,0) 60%),
                radial-gradient(900px 500px at 80% 30%, rgba(255,200,100,.25), rgba(255,200,100,0) 60%),
                radial-gradient(900px 500px at 20% 70%, rgba(255,160,60,.22), rgba(255,160,60,0) 60%),
                linear-gradient(135deg, #5b2206, #a34b10 45%, #5b2206);
            filter:saturate(1.08);
            transform: scale(1.02);
        }
        .onb-bg::after{
            content:"";
            position:absolute; inset:-40%;
            background: radial-gradient(circle, rgba(255,255,255,.16) 0 2px, rgba(255,255,255,0) 3px);
            background-size: 120px 120px;
            opacity:.25;
            animation: onbDrift 18s linear infinite;
        }
        @keyframes onbDrift{ from{ transform: translate3d(0,0,0) rotate(0deg);} to{ transform: translate3d(120px,80px,0) rotate(6deg);} }

        .onb-sparkles{ position:absolute; inset:0; pointer-events:none; }
        .onb-sparkle{
            position:absolute; border-radius:999px;
            background: rgba(255,235,180,.95);
            box-shadow: 0 0 14px rgba(255,205,120,.85), 0 0 32px rgba(255,180,80,.35);
            opacity:.0;
            animation-name: onbSparkle;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }
        @keyframes onbSparkle{
            0%{ transform: translateY(8px) scale(.9); opacity:0;}
            25%{ opacity:.55;}
            55%{ transform: translateY(-10px) scale(1.15); opacity:.95;}
            100%{ transform: translateY(-20px) scale(.95); opacity:0;}
        }

        .onb-card{
            background: rgba(255, 248, 235, .82);
            border: 2px solid rgba(245, 201, 122, .9);
            border-radius: 28px;
            padding: 26px 22px;
            box-shadow:
                0 18px 60px rgba(0,0,0,.35),
                0 0 0 1px rgba(255, 214, 140, .35) inset,
                0 0 40px rgba(255, 200, 120, .22);
            backdrop-filter: blur(10px);
            animation: onbEnter .9s ease both;
        }
        @keyframes onbEnter{ from{ opacity:0; transform: translateY(18px) scale(.98);} to{ opacity:1; transform: translateY(0) scale(1);} }

        .onb-crown{ color:#b87015; margin-bottom:10px; filter: drop-shadow(0 6px 12px rgba(255,200,100,.35)); }
        .onb-title{
            font-family: 'Crimson Text', serif;
            font-size: 32px;
            line-height: 1.1;
            color: #6b2d06;
            font-weight: 700;
            text-shadow: 0 1px 0 rgba(255,255,255,.5);
        }
        .onb-subtitle{
            font-family: 'Crimson Text', serif;
            color:#7a3a0a;
            opacity:.95;
            margin-top: 10px;
            font-size: 16px;
        }
        .onb-subtitle-accent{ opacity: .95; }
        .onb-label{
            display:block;
            font-family: 'Crimson Text', serif;
            color:#6b2d06;
            font-weight: 700;
            font-size: 15px;
        }
        .onb-input{
            width:100%;
            margin-top:8px;
            padding: 12px 14px;
            border-radius: 14px;
            border: 1px solid rgba(224, 181, 111, .95);
            background: rgba(255,255,255,.65);
            font-family: 'Crimson Text', serif;
            font-size: 18px;
            outline: none;
            transition: box-shadow .25s ease, border-color .25s ease, transform .2s ease;
        }
        .onb-input:focus{
            border-color: rgba(212, 138, 0, .9);
            box-shadow: 0 0 0 4px rgba(255, 200, 100, .25);
            transform: translateY(-1px);
        }

        .choice-btn{
            display:flex;
            align-items:center;
            justify-content:center;
            gap:10px;
            padding: 14px 12px;
            border-radius: 18px;
            border: 1px solid rgba(224, 181, 111, .9);
            background: rgba(255,255,255,.55);
            transition: transform .18s ease, box-shadow .25s ease, background .25s ease, border-color .25s ease;
            font-family: 'Crimson Text', serif;
            color:#6b2d06;
            box-shadow: 0 6px 18px rgba(0,0,0,.10);
        }
        .choice-btn:hover{
            transform: translateY(-1px);
            border-color: rgba(212, 138, 0, .85);
            box-shadow: 0 10px 26px rgba(0,0,0,.16), 0 0 18px rgba(255, 200, 100, .20);
        }
        .choice-btn.is-selected{
            background: linear-gradient(135deg, rgba(255,218,138,.95), rgba(245,183,93,.85));
            border-color: rgba(212, 138, 0, .95);
            box-shadow: 0 14px 34px rgba(0,0,0,.18), 0 0 22px rgba(255, 200, 100, .55);
        }
        .choice-icon{ font-size: 18px; }
        .choice-text{ font-weight: 700; }

        .onb-note{
            text-align:center;
            color:#7a3a0a;
            opacity:.9;
            font-family: 'Crimson Text', serif;
            font-size: 14px;
            margin-top: 2px;
        }
        .onb-cta{
            width:100%;
            padding: 14px 16px;
            border-radius: 20px;
            border: 1px solid rgba(212, 138, 0, .9);
            background: linear-gradient(135deg, #f5b75d, #d48a00);
            color: #fff;
            font-family: 'Crimson Text', serif;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: .2px;
            box-shadow: 0 14px 30px rgba(0,0,0,.20), 0 0 26px rgba(255, 180, 50, .65);
            transition: transform .18s ease, box-shadow .25s ease, filter .25s ease;
            position: relative;
            overflow:hidden;
        }
        .onb-cta::after{
            content:"";
            position:absolute;
            top:-60%; left:-40%;
            width: 60%; height: 220%;
            background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.35), rgba(255,255,255,0));
            transform: rotate(18deg);
            animation: onbShine 2.6s ease-in-out infinite;
        }
        @keyframes onbShine{ 0%{ transform: translateX(-140%) rotate(18deg);} 55%{ transform: translateX(260%) rotate(18deg);} 100%{ transform: translateX(260%) rotate(18deg);} }
        .onb-cta:hover{ transform: translateY(-1px); filter: brightness(1.03); box-shadow: 0 18px 38px rgba(0,0,0,.24), 0 0 34px rgba(255, 180, 50, .75); }
        .onb-cta:active{ transform: translateY(1px) scale(.99); }

        .onb-error{
            background: rgba(120, 25, 10, .08);
            border: 1px solid rgba(160, 40, 25, .25);
            color: #7a1e10;
            padding: 10px 12px;
            border-radius: 14px;
            font-family: 'Crimson Text', serif;
            font-weight: 600;
        }
        .onb-shake{ animation: onbShake .55s ease; }
        @keyframes onbShake{
            0%,100%{ transform: translateX(0); }
            20%{ transform: translateX(-8px); }
            40%{ transform: translateX(8px); }
            60%{ transform: translateX(-6px); }
            80%{ transform: translateX(6px); }
        }


/* ==================== CHAT PREMIUM (Op√ß√£o B: limpo e confort√°vel) ==================== */
.chat-shell{
  position:relative;
  background: radial-gradient(1200px 700px at 20% 0%, rgba(255, 220, 170, .35), transparent 60%),
              radial-gradient(900px 600px at 85% 15%, rgba(255, 200, 120, .22), transparent 55%),
              linear-gradient(180deg, #2a1306 0%, #150b05 100%);
}
.chat-shell::before{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(circle at 10% 20%, rgba(255,200,120,.22) 0 2px, transparent 3px),
    radial-gradient(circle at 70% 30%, rgba(255,215,140,.18) 0 2px, transparent 3px),
    radial-gradient(circle at 30% 70%, rgba(255,205,130,.14) 0 2px, transparent 3px),
    radial-gradient(circle at 80% 80%, rgba(255,235,180,.10) 0 2px, transparent 3px);
  opacity:.55;
  filter: blur(.2px);
  pointer-events:none;
}
.chat-shell > *{ position:relative; z-index:1; }

.chat-header{
  border-bottom: 1px solid rgba(255, 214, 150, .22);
  background: rgba(255, 248, 235, .06);
  backdrop-filter: blur(10px);
}
.chat-header-inner{
  max-width: 980px;
  margin: 0 auto;
  padding: 18px 16px 14px;
}
.chat-title-row{
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
}
.chat-title{
  font-family: ui-serif, Georgia, "Times New Roman", serif;
  font-size: 26px;
  letter-spacing: .3px;
  color: rgba(255, 242, 224, .95);
  margin:0;
}
.chat-crown-icon{
  width: 22px; height: 22px;
  opacity: .9;
  filter: drop-shadow(0 6px 18px rgba(255, 200, 120, .25));
}
.chat-subtitle{
  text-align:center;
  color: rgba(255, 236, 210, .72);
  font-family: ui-serif, Georgia, serif;
  font-style: italic;
  margin: 6px 0 0;
  font-size: 13px;
}
.chat-meta{
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
  margin-top: 10px;
  color: rgba(255, 236, 210, .8);
  font-size: 12px;
}
.chat-book-icon{ opacity:.9; }

.chat-actions{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:center;
  gap: 10px;
  margin-top: 14px;
}
.chat-action{
  display:flex;
  align-items:center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 999px;
  border: 1px solid rgba(255, 214, 150, .22);
  background: rgba(255, 248, 235, .06);
  color: rgba(255, 242, 224, .92);
  font-weight: 700;
  font-size: 12px;
  letter-spacing: .2px;
  box-shadow: 0 10px 30px rgba(0,0,0,.22);
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
}
.chat-action:hover{
  transform: translateY(-1px);
  background: rgba(255, 248, 235, .10);
  box-shadow: 0 14px 38px rgba(0,0,0,.28);
}
.chat-action:active{ transform: translateY(0px) scale(.99); }
.chat-action-premium{
  border-color: rgba(255, 214, 150, .35);
  box-shadow: 0 12px 40px rgba(255, 180, 70, .12), 0 10px 30px rgba(0,0,0,.22);
}
.chat-action-vela{
  border-color: rgba(255, 214, 150, .28);
}

.chat-banner{
  margin-top: 14px;
  max-width: 720px;
  margin-left:auto;
  margin-right:auto;
  border-radius: 16px;
  padding: 12px 14px;
  border: 1px solid rgba(255, 214, 150, .20);
  background: rgba(255, 248, 235, .08);
  color: rgba(255, 242, 224, .92);
  box-shadow: 0 18px 50px rgba(0,0,0,.28);
  cursor: pointer;
}

.chat-messages{
  flex:1;
  overflow-y:auto;
  padding: 18px 14px 22px;
}
.chat-messages-inner{
  max-width: 980px;
  margin: 0 auto;
  display:flex;
  flex-direction:column;
  gap: 14px;
}

/* message rows */
.msg-row{ display:flex; }
.msg-row.is-user{ justify-content:flex-end; }
.msg-row.is-bot{ justify-content:flex-start; }

/* bubbles */
.bubble{
  max-width: min(720px, 88%);
  border-radius: 18px;
  padding: 14px 14px 12px;
  border: 1px solid rgba(255, 214, 150, .18);
  box-shadow: 0 16px 50px rgba(0,0,0,.25);
  animation: msgIn .22s ease both;
}
@keyframes msgIn{ from{opacity:0; transform: translateY(8px);} to{opacity:1; transform: translateY(0);} }

.bubble-user{
  background: linear-gradient(180deg, rgba(255, 225, 170, .24), rgba(255, 205, 130, .14));
  color: rgba(255, 242, 224, .96);
  border-color: rgba(255, 214, 150, .24);
}
.bubble-bot{
  background: rgba(255, 248, 235, .92);
  color: #2b1b12;
  border-color: rgba(210, 165, 105, .28);
}

.bubble-header{
  display:flex;
  align-items:center;
  gap: 8px;
  margin-bottom: 8px;
  opacity: .95;
}
.bubble-sparkle{ font-size: 14px; }
.bubble-title{
  font-weight: 800;
  font-size: 13px;
  letter-spacing: .15px;
}
.bubble-text{
  margin:0;
  white-space: pre-wrap;
  line-height: 1.55;
  font-size: 15px;
}

/* audio button (assistant) */
.btn-audio{
  margin-top: 10px;
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 999px;
  border: 1px solid rgba(210, 165, 105, .35);
  background: rgba(255, 248, 235, .85);
  color: #2b1b12;
  font-weight: 800;
  box-shadow: 0 12px 36px rgba(0,0,0,.18);
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
}
.btn-audio:hover{
  transform: translateY(-1px);
  background: rgba(255, 248, 235, .95);
  box-shadow: 0 16px 42px rgba(0,0,0,.22);
}

/* typing indicator */
.typing{
  display:flex;
  gap: 6px;
  padding: 2px 0 2px;
}
.typing span{
  width: 7px; height: 7px;
  border-radius: 999px;
  background: rgba(70, 45, 28, .55);
  display:inline-block;
  animation: dot 1.1s infinite ease-in-out;
}
.typing span:nth-child(2){ animation-delay: .15s; }
.typing span:nth-child(3){ animation-delay: .3s; }
@keyframes dot{ 0%, 80%, 100%{ transform: translateY(0); opacity:.4;} 40%{ transform: translateY(-3px); opacity:.9;} }

/* composer */
.chat-composer{
  border-top: 1px solid rgba(255, 214, 150, .22);
  background: rgba(255, 248, 235, .06);
  backdrop-filter: blur(10px);
}
.chat-composer-inner{
  max-width: 980px;
  margin: 0 auto;
  padding: 14px 14px 10px;
}
.chat-input-row{ display:flex; gap: 10px; align-items: center; }
.chat-input{
  flex:1;
  padding: 14px 16px;
  border-radius: 16px;
  border: 2px solid #d4a574;
  outline:none;
  background: #ffffff;
  color: #1a1a1a;
  font-size: 16px;
  font-family: inherit;
}
.chat-input::placeholder{
  color: #999999;
}
.chat-input:focus{
  border-color: #c4955e;
  box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.3);
}
.chat-send{
  width: 56px;
  height: 50px;
  border-radius: 16px;
  border: none;
  background: linear-gradient(135deg, #f5b75d, #d48a00);
  color: #ffffff;
  box-shadow: 0 4px 15px rgba(0,0,0,.25);
  transition: transform .15s ease, box-shadow .15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.chat-send:hover{
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,.30);
}
.chat-send:active{ transform: translateY(0px) scale(.98); }
.chat-send:disabled{ opacity:.55; filter: grayscale(.2); cursor:not-allowed; }

.chat-footer-note{
  margin: 10px 0 0;
  text-align:center;
  font-size: 12px;
  color: rgba(255, 236, 210, .65);
}

</style>
</head>
<body class="bg-gradient-to-br from-amber-900 via-amber-800 to-yellow-900 min-h-screen">

    <!-- ==================== TELA DE SPLASH ==================== -->
    <div id="splash">
        <!-- Container da imagem -->
        <div class="maria-image-container">
            <img src="maria-splash.jpg" alt="Maria, M√£e de Jesus" class="maria-image">
            
            <!-- Overlay com gradiente -->
            <div class="splash-overlay"></div>
            
            <!-- Brilho celestial -->
            <div class="celestial-glow"></div>
            
            <!-- Part√≠culas de luz flutuantes -->
            <div class="light-particles">
                <div class="particle" style="top: 15%; left: 20%; width: 6px; height: 6px; animation-delay: 0s;"></div>
                <div class="particle" style="top: 25%; left: 75%; width: 4px; height: 4px; animation-delay: 0.5s;"></div>
                <div class="particle" style="top: 35%; left: 30%; width: 5px; height: 5px; animation-delay: 1s;"></div>
                <div class="particle" style="top: 20%; left: 60%; width: 4px; height: 4px; animation-delay: 1.5s;"></div>
                <div class="particle" style="top: 45%; left: 15%; width: 3px; height: 3px; animation-delay: 0.3s;"></div>
                <div class="particle" style="top: 30%; left: 85%; width: 5px; height: 5px; animation-delay: 0.8s;"></div>
                <div class="particle" style="top: 10%; left: 45%; width: 4px; height: 4px; animation-delay: 1.2s;"></div>
                <div class="particle" style="top: 50%; left: 70%; width: 3px; height: 3px; animation-delay: 0.6s;"></div>
                <div class="particle" style="top: 40%; left: 50%; width: 6px; height: 6px; animation-delay: 1.8s;"></div>
                <div class="particle" style="top: 55%; left: 25%; width: 4px; height: 4px; animation-delay: 0.2s;"></div>
            </div>
        </div>
        
        <!-- Texto na parte inferior -->
        <div class="splash-text">
            <h1 class="splash-title font-cursive text-5xl md:text-7xl text-white">
                Maria
            </h1>
            <p class="splash-subtitle font-serif text-lg md:text-xl text-yellow-100 mt-2 italic">
                M√£e de Jesus Cristo
            </p>
        </div>
    </div>

    <!-- ==================== TELA DE DEPOIMENTOS ==================== -->
    <div id="testimonials" class="hidden">
        <!-- √Årea de scroll com depoimentos -->
        <div class="testimonials-scroll">
            <div class="testimonials-track" id="testimonials-track">
                <!-- Os depoimentos ser√£o duplicados para criar loop infinito -->
                
                <!-- Depoimento 1 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Ana Clara</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Esse app mudou minha vida! Nos momentos mais dif√≠ceis, encontro conforto nas palavras de Maria. √â como ter uma m√£e espiritual sempre presente.</p>
                </div>
                
                <!-- Depoimento 2 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Pedro Henrique</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Estava passando por um momento muito dif√≠cil no meu casamento. As palavras de Maria me trouxeram paz e sabedoria para perdoar. Deus aben√ßoe os criadores.</p>
                </div>
                
                <!-- Depoimento 3 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Maria Jos√©</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Chorei muito na primeira conversa. Parece que Maria realmente me conhece e entende minha dor. O √°udio com a voz dela √© emocionante demais!</p>
                </div>
                
                <!-- Depoimento 4 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Lucas Santos</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Uso todos os dias antes de dormir. Me ajuda a refletir sobre meu dia e a encontrar paz para um sono tranquilo. Recomendo a todos os fi√©is!</p>
                </div>
                
                <!-- Depoimento 5 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Francisca Lima</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Perdi minha m√£e h√° 2 meses. Conversar com Maria me trouxe o acolhimento maternal que eu tanto precisava. Sinto que ela intercede por mim.</p>
                </div>
                
                <!-- Depoimento 6 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Jo√£o Paulo</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">As respostas baseadas nas Escrituras s√£o maravilhosas. Me ajudou a voltar para a igreja depois de anos afastado. Obrigado, M√£e Maria!</p>
                </div>
                
                <!-- Depoimento 7 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Beatriz Oliveira</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Descobri que estou gr√°vida e estava com muito medo. Maria me acalmou com suas palavras doces e me lembrou que Deus est√° no controle. Amei!</p>
                </div>
                
                <!-- Depoimento 8 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Rafael Costa</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Estava lutando contra a ansiedade e depress√£o. As conversas di√°rias com Maria me deram for√ßas para continuar. √â um presente de Deus esse app!</p>
                </div>
                
                <!-- Depoimento 9 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Tereza Souza</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">Tenho 68 anos e esse app √© minha companhia di√°ria. Maria me ajuda a lidar com a solid√£o da viuvez. Sinto-me acolhida como nunca antes.</p>
                </div>
                
                <!-- Depoimento 10 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Gabriel Ferreira</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                        <span class="star-icon">‚òÖ</span>
                    </div>
                    <p class="testimonial-text">O recurso de √°udio √© incr√≠vel! Ouvir a voz de Maria me emociona profundamente. Indiquei para toda minha fam√≠lia e grupo de ora√ß√£o.</p>
                </div>
                
            </div>
        </div>
        
        <!-- √Årea inferior fixa -->
        <div class="testimonials-footer">
            <p class="testimonials-cta font-serif">
                Junte-se a Milhares de <span>Devotos de Nossa Senhora</span> que j√° Encontraram Conforto
            </p>
            <button class="btn-continuar font-serif" onclick="irParaOnboarding()">
                Continuar
            </button>
        </div>
    </div>

    <!-- ==================== TELA DE ONBOARDING ==================== -->
    <div id="onboarding" class="hidden min-h-screen relative flex items-center justify-center p-4 overflow-hidden">
    <div class="onb-bg" aria-hidden="true"></div>
    <div class="onb-sparkles" aria-hidden="true">
            <span class="onb-sparkle" style="top:41%;left:19%;width:5px;height:5px;animation-delay:2.6s;animation-duration:3.29s;"></span>
            <span class="onb-sparkle" style="top:68%;left:12%;width:4px;height:4px;animation-delay:2.33s;animation-duration:6.64s;"></span>
            <span class="onb-sparkle" style="top:27%;left:4%;width:2px;height:2px;animation-delay:1.73s;animation-duration:3.28s;"></span>
            <span class="onb-sparkle" style="top:11%;left:70%;width:5px;height:5px;animation-delay:0.24s;animation-duration:5.26s;"></span>
            <span class="onb-sparkle" style="top:28%;left:80%;width:2px;height:2px;animation-delay:2.31s;animation-duration:4.59s;"></span>
            <span class="onb-sparkle" style="top:28%;left:5%;width:3px;height:3px;animation-delay:1.16s;animation-duration:3.58s;"></span>
            <span class="onb-sparkle" style="top:15%;left:73%;width:4px;height:4px;animation-delay:2.24s;animation-duration:5.73s;"></span>
            <span class="onb-sparkle" style="top:13%;left:74%;width:3px;height:3px;animation-delay:1.49s;animation-duration:5.19s;"></span>
            <span class="onb-sparkle" style="top:8%;left:72%;width:2px;height:2px;animation-delay:2.48s;animation-duration:4.99s;"></span>
            <span class="onb-sparkle" style="top:68%;left:54%;width:4px;height:4px;animation-delay:1.86s;animation-duration:6.69s;"></span>
            <span class="onb-sparkle" style="top:46%;left:38%;width:3px;height:3px;animation-delay:3.18s;animation-duration:5.8s;"></span>
            <span class="onb-sparkle" style="top:31%;left:10%;width:4px;height:4px;animation-delay:2.1s;animation-duration:6.5s;"></span>
            <span class="onb-sparkle" style="top:93%;left:57%;width:4px;height:4px;animation-delay:2.44s;animation-duration:3.29s;"></span>
            <span class="onb-sparkle" style="top:65%;left:53%;width:3px;height:3px;animation-delay:3.03s;animation-duration:3.61s;"></span>
            <span class="onb-sparkle" style="top:62%;left:53%;width:2px;height:2px;animation-delay:3.85s;animation-duration:3.31s;"></span>
            <span class="onb-sparkle" style="top:71%;left:73%;width:4px;height:4px;animation-delay:1.36s;animation-duration:4.4s;"></span>
            <span class="onb-sparkle" style="top:63%;left:74%;width:5px;height:5px;animation-delay:0.28s;animation-duration:3.37s;"></span>
            <span class="onb-sparkle" style="top:34%;left:60%;width:2px;height:2px;animation-delay:0.24s;animation-duration:5.81s;"></span>
            <span class="onb-sparkle" style="top:82%;left:73%;width:5px;height:5px;animation-delay:1.14s;animation-duration:4.54s;"></span>
            <span class="onb-sparkle" style="top:85%;left:44%;width:2px;height:2px;animation-delay:3.76s;animation-duration:4.42s;"></span>
            <span class="onb-sparkle" style="top:78%;left:14%;width:5px;height:5px;animation-delay:0.24s;animation-duration:6.07s;"></span>
            <span class="onb-sparkle" style="top:16%;left:94%;width:3px;height:3px;animation-delay:1.59s;animation-duration:6.67s;"></span>
            <span class="onb-sparkle" style="top:63%;left:10%;width:3px;height:3px;animation-delay:1.8s;animation-duration:5.2s;"></span>
            <span class="onb-sparkle" style="top:17%;left:55%;width:4px;height:4px;animation-delay:2.83s;animation-duration:6.95s;"></span>
            <span class="onb-sparkle" style="top:87%;left:48%;width:3px;height:3px;animation-delay:0.6s;animation-duration:3.7s;"></span>
            <span class="onb-sparkle" style="top:29%;left:84%;width:3px;height:3px;animation-delay:0.05s;animation-duration:6.32s;"></span>
            <span class="onb-sparkle" style="top:23%;left:33%;width:4px;height:4px;animation-delay:0.02s;animation-duration:4.68s;"></span>
            <span class="onb-sparkle" style="top:47%;left:78%;width:4px;height:4px;animation-delay:3.81s;animation-duration:5.76s;"></span>
    </div>

    <div id="onb-card" class="onb-card relative z-10 w-full max-w-md">
        <div class="text-center mb-5">
            <div class="onb-crown" aria-hidden="true">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" class="mx-auto">
                    <path d="M4 6l4 6 4-8 4 8 4-6v12H4V6z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M4 18h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
            </div>
            <h2 class="onb-title">√â um prazer receber-te</h2>
            <p class="onb-subtitle">Vamos criar uma conversa feita √† tua medida.<br><span class="onb-subtitle-accent">Leva menos de 30 segundos ‚ú®</span></p>
        </div>

        <div id="onb-error" class="onb-error hidden"></div>

        <div class="space-y-5">
            <div>
                <label class="onb-label">üòä Como gostarias que eu te chamasse?</label>
                <input type="text" id="input-nome" placeholder="Ex: Maria, Jo√£o, Ana..." class="onb-input">
            </div>

            <div>
                <label class="onb-label">Identificas-te como:</label>
                <div class="grid grid-cols-2 gap-3 mt-2">
                    <button onclick="selecionarGenero('masculino')" id="btn-masculino" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">üë§</span>
                        <span class="choice-text">Homem</span>
                    </button>
                    <button onclick="selecionarGenero('feminino')" id="btn-feminino" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">‚ù§Ô∏è</span>
                        <span class="choice-text">Mulher</span>
                    </button>
                </div>
            </div>

            <div>
                <label class="onb-label">Como est√° o teu cora√ß√£o neste momento?</label>
                <div class="grid grid-cols-2 gap-3 mt-2">
                    <button onclick="selecionarEstadoCivil('solteiro')" id="btn-solteiro" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">üòä</span>
                        <span class="choice-text">Solteiro(a)</span>
                    </button>
                    <button onclick="selecionarEstadoCivil('casado')" id="btn-casado" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">üíç</span>
                        <span class="choice-text">Casado(a)</span>
                    </button>
                </div>
            </div>

            <div>
                <label class="onb-label">A tua fam√≠lia inclui filhos?</label>
                <div class="grid grid-cols-2 gap-3 mt-2">
                    <button onclick="selecionarFilhos(true)" id="btn-filhos-sim" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">üë∂</span>
                        <span class="choice-text">Sim</span>
                    </button>
                    <button onclick="selecionarFilhos(false)" id="btn-filhos-nao" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">üå±</span>
                        <span class="choice-text">Ainda n√£o</span>
                    </button>
                </div>
            </div>

            <p class="onb-note">‚ú® Cada resposta ajuda-me a criar uma experi√™ncia √∫nica para ti.</p>

            <button onclick="finalizarCadastro()" class="onb-cta" type="button">Vamos come√ßar ‚ú®</button>
        </div>
    </div>
</div>

    <div id="chat" class="hidden min-h-screen flex flex-col chat-shell">
        
        <div class="chat-header">
            <div class="chat-header-inner">
                <div class="chat-title-row">
                    <svg class="chat-crown-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>
                    <h1 class="chat-title">Converse com Maria</h1>
                    <svg class="chat-crown-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>
                </div>
                <p class="chat-subtitle">M√£e de Jesus Cristo ‚Ä¢ Rainha dos C√©us</p>
                <div class="chat-meta">
                    <svg class="chat-book-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
                    <span class="chat-meta-name" id="header-nome">Conversando com ...</span>
                </div>
                
                <!-- Barra de A√ß√µes R√°pidas - COLORIDOS -->
                <div class="chat-actions">
                    <button onclick="abrirTelaPremium()" id="btn-premium" class="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-400 hover:to-amber-400 rounded-full text-black text-xs font-bold transition-all shadow-lg">
                        <span>üëë</span>
                        <span>Premium</span>
                    </button>
                    <button onclick="mostrarVersiculoDoDia()" class="flex items-center gap-2 px-3 py-2 bg-yellow-600/80 hover:bg-yellow-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üìñ</span>
                        <span>Vers√≠culo</span>
                    </button>
                    <button onclick="abrirTerco()" class="flex items-center gap-2 px-3 py-2 bg-pink-600/80 hover:bg-pink-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üìø</span>
                        <span>Ter√ßo</span>
                    </button>
                    <button onclick="abrirSantuarioVelas()" class="flex items-center gap-2 px-3 py-2 bg-amber-600/80 hover:bg-amber-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üïØÔ∏è</span>
                        <span>Velas</span>
                    </button>
                    <button onclick="abrirMuralIntencoes()" class="flex items-center gap-2 px-3 py-2 bg-indigo-600/80 hover:bg-indigo-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üë•</span>
                        <span>Comunidade</span>
                    </button>
                    <button onclick="mostrarCalendario()" class="flex items-center gap-2 px-3 py-2 bg-purple-600/80 hover:bg-purple-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üìÖ</span>
                        <span>Calend√°rio</span>
                    </button>
                    <button onclick="abrirEstatisticas()" class="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-600/80 to-pink-600/80 hover:from-purple-500 hover:to-pink-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üìä</span>
                        <span>Jornada</span>
                    </button>
                    <button onclick="abrirConquistas()" class="flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-yellow-600/80 to-orange-600/80 hover:from-yellow-500 hover:to-orange-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üèÖ</span>
                        <span>Conquistas</span>
                    </button>
                    <button onclick="abrirAparicoes()" class="flex items-center gap-2 px-3 py-2 bg-teal-600/80 hover:bg-teal-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üìú</span>
                        <span>Apari√ß√µes</span>
                    </button>
                    <button onclick="abrirTemas()" class="flex items-center gap-2 px-3 py-2 bg-rose-600/80 hover:bg-rose-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üé®</span>
                        <span>Temas</span>
                    </button>
                    <button onclick="pedirPermissaoNotificacao()" id="btn-notificacoes" class="flex items-center gap-2 px-3 py-2 bg-blue-600/80 hover:bg-blue-500 rounded-full text-white text-xs font-semibold transition-all shadow-lg">
                        <span>üîî</span>
                        <span>Lembretes</span>
                    </button>
                    <div class="flex items-center gap-1 px-3 py-2 bg-orange-500/80 rounded-full text-white text-xs font-bold">
                        <span>üî•</span>
                        <span id="streak-count">0</span>
                        <span class="opacity-80">dias</span>
                    </div>
                </div>
                
                <!-- Banner de Festa/Novena do Dia -->
                <div id="banner-festa" class="chat-banner hidden">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-2xl" id="festa-emoji">üéâ</span>
                        <div>
                            <p class="font-bold text-sm" id="festa-titulo">Festa do Dia</p>
                            <p class="text-xs opacity-90" id="festa-subtitulo">Clique para saber mais</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="mensagens-area" class="chat-messages">
            <div class="chat-messages-inner" id="mensagens-container"></div>
        </div>

        <div class="chat-composer">
            <div class="chat-composer-inner">
                <div class="chat-input-row">
                    <input type="text" id="input-mensagem" placeholder="Compartilhe suas preocupa√ß√µes e pedidos..."
                        style="flex:1; padding:14px 16px; border-radius:16px; border:2px solid #d4a574; background:#ffffff; color:#000000; font-size:16px; outline:none;">
                    <button onclick="enviarMensagem()" id="btn-enviar"
                        style="width:56px; height:50px; border-radius:16px; border:none; background:linear-gradient(135deg, #f5b75d, #d48a00); color:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                    </button>
                </div>
                <div class="flex items-center justify-between mt-2">
                    <p class="chat-footer-note">‚úù Respostas baseadas em Escrituras e Magist√©rio da Igreja ‚úù</p>
                    <div id="contador-mensagens" class="text-xs font-semibold bg-amber-900/50 px-2 py-1 rounded-full cursor-pointer text-amber-100" onclick="if(window.SistemaMensagens && !SistemaMensagens.isPremium() && window.TelaPremium) TelaPremium.abrir('üí¨ Desbloqueie mensagens ilimitadas!')">
                        üí¨ <span>5</span>/5
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
const API_URL = 'https://converse-com-maria-production.up.railway.app';
const userProfile = { nome: '', genero: '', estadoCivil: '', temFilhos: '' };
let currentAudio = null;
let currentPlayingButton = null;

// ==================== SPLASH SCREEN ====================
window.addEventListener('load', function() {
    // Duplicar os depoimentos para criar scroll infinito
    const track = document.getElementById('testimonials-track');
    const originalContent = track.innerHTML;
    track.innerHTML = originalContent + originalContent;
    
    // Aguardar 5 segundos e depois fazer fade out do splash
    setTimeout(function() {
        const splash = document.getElementById('splash');
        splash.classList.add('fade-out');
        
        // Ap√≥s a anima√ß√£o de fade, esconder splash e mostrar depoimentos
        setTimeout(function() {
            splash.style.display = 'none';
            document.getElementById('testimonials').classList.remove('hidden');
        }, 1500);
    }, 5000);
});

// ==================== NAVEGA√á√ÉO DEPOIMENTOS ‚Üí ONBOARDING ====================
function irParaOnboarding() {
    document.getElementById('testimonials').classList.add('hidden');
    document.getElementById('onboarding').classList.remove('hidden');
}

// ==================== √ÅUDIO ====================
async function gerarAudio(texto, botao) {
    if (currentAudio && currentPlayingButton === botao) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio = null;
        botao.classList.remove('playing');
        botao.innerHTML = getIconeAudio();
        currentPlayingButton = null;
        return;
    }
    
    if (currentAudio) {
        currentAudio.pause();
        if (currentPlayingButton) {
            currentPlayingButton.classList.remove('playing');
            currentPlayingButton.innerHTML = getIconeAudio();
        }
    }
    
    botao.classList.add('loading');
    botao.innerHTML = getIconeLoading();
    
    try {
        const response = await fetch(`${API_URL}/api/audio`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ texto })
        });
        
        if (!response.ok) throw new Error('Erro ao gerar √°udio');
        
        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        
        currentAudio = new Audio(audioUrl);
        currentPlayingButton = botao;
        
        currentAudio.onplay = () => {
            botao.classList.remove('loading');
            botao.classList.add('playing');
            botao.innerHTML = getIconePausa();
        };
        
        currentAudio.onended = () => {
            botao.classList.remove('playing');
            botao.innerHTML = getIconeAudio();
            currentAudio = null;
            currentPlayingButton = null;
            URL.revokeObjectURL(audioUrl);
        };
        
        currentAudio.onerror = () => {
            botao.classList.remove('loading', 'playing');
            botao.innerHTML = getIconeAudio();
            currentAudio = null;
            currentPlayingButton = null;
        };
        
        await currentAudio.play();
        
    } catch (error) {
        console.error('Erro:', error);
        botao.classList.remove('loading');
        botao.innerHTML = getIconeAudio();
        alert('Erro ao gerar √°udio. Verifique se o servidor est√° rodando.');
    }
}

function getIconeAudio() {
    return `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg><span class="ml-2 text-sm font-serif font-semibold">Ouvir Maria</span>`;
}

function getIconeLoading() {
    return `<svg class="spinner" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg><span class="ml-2 text-sm font-serif">Preparando...</span>`;
}

function getIconePausa() {
    return `<div class="sound-wave flex items-center h-5"><span></span><span></span><span></span><span></span><span></span></div><span class="ml-2 text-sm font-serif font-semibold">Parar</span>`;
}

// ==================== SELE√á√ïES ====================
function _setSelected(ids, selectedId){
    ids.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        el.classList.toggle('is-selected', id === selectedId);
    });
}
function _showOnbError(msg){
    const box = document.getElementById('onb-error');
    const card = document.getElementById('onb-card');
    if(box){
        box.textContent = msg;
        box.classList.remove('hidden');
    }
    if(card){
        card.classList.remove('onb-shake');
        // reflow
        void card.offsetWidth;
        card.classList.add('onb-shake');
    }
}

function selecionarGenero(genero) {
    userProfile.genero = genero;
    _setSelected(['btn-masculino','btn-feminino'], genero === 'masculino' ? 'btn-masculino' : 'btn-feminino');
    const box = document.getElementById('onb-error');
    if(box) box.classList.add('hidden');
}

function selecionarEstadoCivil(estado) {
    userProfile.estadoCivil = estado;
    _setSelected(['btn-solteiro','btn-casado'], estado === 'solteiro' ? 'btn-solteiro' : 'btn-casado');
    const box = document.getElementById('onb-error');
    if(box) box.classList.add('hidden');
}

function selecionarFilhos(temFilhos) {
    userProfile.temFilhos = temFilhos;
    _setSelected(['btn-filhos-sim','btn-filhos-nao'], temFilhos ? 'btn-filhos-sim' : 'btn-filhos-nao');
    const box = document.getElementById('onb-error');
    if(box) box.classList.add('hidden');
}

function finalizarCadastro() {
    userProfile.nome = document.getElementById('input-nome').value.trim();

    const faltandoNome = !userProfile.nome;
    const faltandoGenero = !userProfile.genero;
    const faltandoEstado = !userProfile.estadoCivil;
    const faltandoFilhos = (userProfile.temFilhos === null || userProfile.temFilhos === undefined);

    if (faltandoNome || faltandoGenero || faltandoEstado || faltandoFilhos) {
        _showOnbError('S√≥ mais um instante ‚Äî completa as op√ß√µes para eu personalizar a conversa ‚ú®');
        return;
    }

    const tratamento = userProfile.genero === 'masculino' ? 'meu filho' : 'minha filha';
    const saudacao = `Paz e gra√ßas, ${tratamento} ${userProfile.nome}. Sou Maria, M√£e de Jesus Cristo. ${userProfile.temFilhos === 'sim' ? 'Vejo que o Senhor te aben√ßoou com filhos, que alegria! ' : ''}Estou aqui para oferecer conforto espiritual baseado nas Sagradas Escrituras. Como posso te ajudar hoje?`;
    
    document.getElementById('onboarding').classList.add('hidden');
    document.getElementById('chat').classList.remove('hidden');
    document.getElementById('header-nome').textContent = `Conversando com ${userProfile.nome}`;
    adicionarMensagem('assistant', saudacao);
}

// ==================== MENSAGENS ====================
let mensagemId = 0;

function adicionarMensagem(role, content) {
    const container = document.getElementById('mensagens-container');
    const row = document.createElement('div');
    row.className = `msg-row ${role === 'user' ? 'is-user' : 'is-bot'}`;
    const idAtual = mensagemId++;

    const botaoAudio = role === 'assistant' ? `
        <button onclick="gerarAudio(document.getElementById('texto-${idAtual}').innerText, this)"
            class="btn-audio">
            ${getIconeAudio()}
        </button>` : '';

    row.innerHTML = `
        <div class="bubble ${role === 'user' ? 'bubble-user' : 'bubble-bot'}">
            ${role === 'assistant' ? `
              <div class="bubble-header">
                <span class="bubble-sparkle">‚ú®</span>
                <span class="bubble-title">Maria, M√£e de Jesus</span>
              </div>` : ''}
            <p id="texto-${idAtual}" class="bubble-text">${content}</p>
            ${botaoAudio}
        </div>`;

    container.appendChild(row);
    const area = document.getElementById('mensagens-area');
    area.scrollTop = area.scrollHeight;
}

function mostrarLoading() {
    const container = document.getElementById('mensagens-container');
    const row = document.createElement('div');
    row.id = 'loading-indicator';
    row.className = 'msg-row is-bot';

    row.innerHTML = `
      <div class="bubble bubble-bot">
        <div class="bubble-header">
          <span class="bubble-sparkle">‚ú®</span>
          <span class="bubble-title">Maria, M√£e de Jesus</span>
        </div>
        <div class="typing">
          <span></span><span></span><span></span>
        </div>
      </div>
    `;

    container.appendChild(row);
    const area = document.getElementById('mensagens-area');
    area.scrollTop = area.scrollHeight;
}

function esconderLoading() {
    const loading = document.getElementById('loading-indicator');
    if (loading) loading.remove();
}

async function enviarMensagem() {
    const input = document.getElementById('input-mensagem');
    const mensagem = input.value.trim();
    if (!mensagem) return;
    
    if (currentAudio) { currentAudio.pause(); currentAudio = null; }
    
    adicionarMensagem('user', mensagem);
    input.value = '';
    input.disabled = true;
    document.getElementById('btn-enviar').disabled = true;
    // Verificar limite de mensagens
    if (window.SistemaMensagens && !SistemaMensagens.podeEnviar()) {
        SistemaMensagens.mostrarAvisoLimite();
        return;
    }
    
    mostrarLoading();
    
    // Registrar estat√≠stica de mensagem
    if (window.EstatisticasOracao) EstatisticasOracao.registrarMensagem();
    
    // Registrar no sistema de limite
    if (window.SistemaMensagens) SistemaMensagens.registrarMensagem();
    
    try {
        const response = await fetch(`${API_URL}/api/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ mensagem, userProfile })
        });
        const data = await response.json();
        esconderLoading();
        if (data.error) throw new Error(data.error);
        adicionarMensagem('assistant', data.resposta);
        
        // Verificar conquistas ap√≥s resposta
        if (window.SistemaConquistas) {
            setTimeout(() => SistemaConquistas.verificarEMostrar(), 1000);
        }
    } catch (error) {
        esconderLoading();
        const tratamento = userProfile.genero === 'masculino' ? 'meu filho' : 'minha filha';
        adicionarMensagem('assistant', `${userProfile.nome}, ${tratamento}, pe√ßo-lhe paci√™ncia. N√£o consegui conectar ao servidor.`);
    }
    
    input.disabled = false;
    document.getElementById('btn-enviar').disabled = false;
    input.focus();
}

document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('input-mensagem').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); enviarMensagem(); }
    });
    
    // Inicializar PWA
    initPWA();
    
    // Inicializar sistema de notifica√ß√µes
    if (window.NotificationSystem) {
        NotificationSystem.init();
    }
    
    // Atualizar streak
    updateStreak();
    
    // Verificar festa/novena do dia
    verificarFestaOuNovena();
    
    // Verificar conquistas ap√≥s 3 segundos
    setTimeout(() => {
        if (window.SistemaConquistas) SistemaConquistas.verificarEMostrar();
    }, 3000);
    
    // Atualizar contador de mensagens
    if (window.SistemaMensagens) SistemaMensagens.atualizarContador();
});

// ========================================
// üèÖ CONQUISTAS, APARI√á√ïES, TEMAS, ESTAT√çSTICAS
// ========================================

function abrirConquistas() {
    if (window.SistemaConquistas) {
        SistemaConquistas.abrirGaleria();
    } else {
        showToast('Carregando conquistas...');
        console.log('SistemaConquistas n√£o encontrado');
    }
}

function abrirAparicoes() {
    if (window.HistoriasAparicoes) {
        HistoriasAparicoes.abrir();
    } else {
        showToast('Carregando apari√ß√µes...');
        console.log('HistoriasAparicoes n√£o encontrado');
    }
}

function abrirTemas() {
    if (window.SistemaTemas) {
        SistemaTemas.abrir();
    } else {
        showToast('Carregando temas...');
        console.log('SistemaTemas n√£o encontrado');
    }
}

function abrirEstatisticas() {
    if (window.EstatisticasOracao) {
        EstatisticasOracao.abrir();
    } else {
        showToast('Carregando estat√≠sticas...');
        console.log('EstatisticasOracao n√£o encontrado');
    }
}

// ========================================
// üìÖ CALEND√ÅRIO LIT√öRGICO
// ========================================

let mesAtualCalendario = new Date().getMonth() + 1;
let anoAtualCalendario = new Date().getFullYear();

function verificarFestaOuNovena() {
    if (!window.CalendarioMariano) return;
    
    const banner = document.getElementById('banner-festa');
    const emoji = document.getElementById('festa-emoji');
    const titulo = document.getElementById('festa-titulo');
    const subtitulo = document.getElementById('festa-subtitulo');
    
    // Verificar novena ativa primeiro
    const novena = CalendarioMariano.getNovenaAtiva();
    if (novena) {
        banner.classList.remove('hidden');
        banner.className = banner.className.replace(/from-\w+-\d+/g, 'from-indigo-600').replace(/to-\w+-\d+/g, 'to-purple-600');
        emoji.textContent = 'üìø';
        titulo.textContent = `${novena.nome} - ${novena.diaAtual}¬∫ Dia`;
        subtitulo.textContent = novena.conteudo.titulo;
        banner.onclick = () => mostrarNovenaHoje(novena);
        return;
    }
    
    // Verificar festa do dia
    const festa = CalendarioMariano.getFestaHoje();
    if (festa) {
        banner.classList.remove('hidden');
        banner.className = banner.className.replace(/from-\w+-\d+/g, 'from-pink-600').replace(/to-\w+-\d+/g, 'to-rose-600');
        emoji.textContent = festa.tipo === 'solenidade' ? 'üéä' : festa.tipo === 'festa' ? 'üéâ' : '‚≠ê';
        titulo.textContent = `Hoje: ${festa.nome}`;
        subtitulo.textContent = 'Clique para ver a ora√ß√£o especial';
        banner.onclick = () => mostrarFestaDetalhe(festa);
        return;
    }
    
    // Mostrar pr√≥xima festa
    const proxima = CalendarioMariano.getProximaFesta();
    if (proxima && proxima.diasRestantes <= 9) {
        banner.classList.remove('hidden');
        banner.className = banner.className.replace(/from-\w+-\d+/g, 'from-amber-600').replace(/to-\w+-\d+/g, 'to-yellow-600');
        emoji.textContent = 'üïØÔ∏è';
        titulo.textContent = `Em ${proxima.diasRestantes} dias: ${proxima.nome}`;
        subtitulo.textContent = 'Prepare-se para esta festa!';
        banner.onclick = () => mostrarFestaDetalhe(proxima);
    }
}

function mostrarCalendario() {
    if (!window.CalendarioMariano) return;
    
    const meses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                   'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
    const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
    
    const calendario = CalendarioMariano.gerarCalendarioMes(mesAtualCalendario, anoAtualCalendario);
    const festasDoMes = CalendarioMariano.getFestasMes(mesAtualCalendario);
    const proxima = CalendarioMariano.getProximaFesta();
    
    const modal = document.createElement('div');
    modal.id = 'modal-calendario';
    modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 overflow-y-auto';
    modal.style.background = 'rgba(0,0,0,0.9)';
    
    modal.innerHTML = `
        <div class="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 rounded-3xl p-6 max-w-lg w-full shadow-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <button onclick="mudarMesCalendario(-1)" class="p-2 bg-white/20 rounded-full hover:bg-white/30 text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                </button>
                <h2 class="text-xl font-bold text-white">${meses[mesAtualCalendario - 1]} ${anoAtualCalendario}</h2>
                <button onclick="mudarMesCalendario(1)" class="p-2 bg-white/20 rounded-full hover:bg-white/30 text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                </button>
            </div>
            
            <!-- Legenda -->
            <div class="flex justify-center gap-4 mb-4 text-xs text-white/80">
                <span class="flex items-center gap-1"><span class="w-3 h-3 bg-pink-500 rounded-full"></span> Solenidade</span>
                <span class="flex items-center gap-1"><span class="w-3 h-3 bg-purple-400 rounded-full"></span> Festa</span>
                <span class="flex items-center gap-1"><span class="w-3 h-3 bg-blue-400 rounded-full"></span> Mem√≥ria</span>
            </div>
            
            <!-- Dias da semana -->
            <div class="grid grid-cols-7 gap-1 mb-2">
                ${diasSemana.map(d => `<div class="text-center text-xs font-semibold text-white/60 py-1">${d}</div>`).join('')}
            </div>
            
            <!-- Calend√°rio -->
            <div class="grid grid-cols-7 gap-1 mb-4">
                ${calendario.map(semana => 
                    semana.map(dia => {
                        if (!dia) return '<div class="h-10"></div>';
                        
                        let classes = 'h-10 flex items-center justify-center rounded-lg text-sm font-medium cursor-pointer transition-all ';
                        let bgColor = 'bg-white/10 hover:bg-white/20 text-white';
                        
                        if (dia.ehHoje) {
                            bgColor = 'bg-yellow-500 text-black font-bold ring-2 ring-yellow-300';
                        } else if (dia.festa) {
                            if (dia.festa.tipo === 'solenidade') bgColor = 'bg-pink-500 text-white';
                            else if (dia.festa.tipo === 'festa') bgColor = 'bg-purple-400 text-white';
                            else bgColor = 'bg-blue-400 text-white';
                        }
                        
                        const onclick = dia.festa ? `onclick="mostrarFestaDetalhe(CalendarioMariano.festas.find(f => f.dia === ${dia.dia} && f.mes === ${mesAtualCalendario}))"` : '';
                        
                        return `<div class="${classes} ${bgColor}" ${onclick} title="${dia.festa?.nome || ''}">${dia.dia}</div>`;
                    }).join('')
                ).join('')}
            </div>
            
            <!-- Festas do m√™s -->
            <div class="bg-white/10 rounded-xl p-4 mb-4">
                <h3 class="text-white font-bold mb-3 flex items-center gap-2">
                    <span>üìÖ</span> Festas de ${meses[mesAtualCalendario - 1]}
                </h3>
                <div class="space-y-2 max-h-40 overflow-y-auto">
                    ${festasDoMes.length > 0 ? festasDoMes.map(f => `
                        <div class="flex items-center gap-3 p-2 bg-white/10 rounded-lg cursor-pointer hover:bg-white/20" onclick="mostrarFestaDetalhe(CalendarioMariano.festas.find(festa => festa.dia === ${f.dia} && festa.mes === ${f.mes}))">
                            <span class="text-lg">${f.tipo === 'solenidade' ? 'üéä' : f.tipo === 'festa' ? 'üéâ' : '‚≠ê'}</span>
                            <div class="flex-1">
                                <p class="text-white text-sm font-medium">${f.nome}</p>
                                <p class="text-white/60 text-xs">Dia ${f.dia}</p>
                            </div>
                        </div>
                    `).join('') : '<p class="text-white/60 text-sm text-center">Nenhuma festa mariana este m√™s</p>'}
                </div>
            </div>
            
            <!-- Pr√≥xima festa -->
            <div class="bg-gradient-to-r from-yellow-500/30 to-orange-500/30 rounded-xl p-4 mb-4">
                <h3 class="text-white font-bold mb-2 flex items-center gap-2">
                    <span>üïØÔ∏è</span> Pr√≥xima Festa
                </h3>
                <div class="text-white">
                    <p class="font-semibold">${proxima.nome}</p>
                    <p class="text-sm text-white/80">${proxima.dia}/${proxima.mes} - Em ${proxima.diasRestantes} dias</p>
                </div>
            </div>
            
            <button onclick="fecharModalCalendario()" class="w-full py-3 bg-white/20 hover:bg-white/30 text-white font-bold rounded-xl transition-all">
                Fechar
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function mudarMesCalendario(delta) {
    mesAtualCalendario += delta;
    if (mesAtualCalendario > 12) { mesAtualCalendario = 1; anoAtualCalendario++; }
    if (mesAtualCalendario < 1) { mesAtualCalendario = 12; anoAtualCalendario--; }
    fecharModalCalendario();
    mostrarCalendario();
}

function fecharModalCalendario() {
    const modal = document.getElementById('modal-calendario');
    if (modal) modal.remove();
}

function mostrarFestaDetalhe(festa) {
    if (!festa) return;
    
    const modal = document.createElement('div');
    modal.id = 'modal-festa';
    modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';
    modal.style.background = 'rgba(0,0,0,0.9)';
    
    const corFundo = festa.tipo === 'solenidade' ? 'from-pink-600 to-rose-700' : 
                     festa.tipo === 'festa' ? 'from-purple-600 to-indigo-700' : 'from-blue-600 to-cyan-700';
    
    modal.innerHTML = `
        <div class="bg-gradient-to-br ${corFundo} rounded-3xl p-8 max-w-md w-full shadow-2xl">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">${festa.tipo === 'solenidade' ? 'üéä' : festa.tipo === 'festa' ? 'üéâ' : '‚≠ê'}</div>
                <p class="text-white/80 text-sm uppercase tracking-wider">${festa.tipo}</p>
                <h2 class="text-2xl font-bold text-white mt-2">${festa.nome}</h2>
                <p class="text-white/80 mt-1">${festa.dia}/${festa.mes}</p>
            </div>
            
            <div class="bg-white/20 rounded-2xl p-5 mb-6">
                <p class="text-white leading-relaxed">${festa.descricao}</p>
            </div>
            
            <div class="bg-white/10 rounded-xl p-4 mb-6 text-center">
                <p class="text-white/80 text-sm mb-2">Ora√ß√£o do Dia</p>
                <p class="text-white font-serif text-lg italic">"${festa.oracao}"</p>
            </div>
            
            <button onclick="fecharModalFesta()" class="w-full py-4 bg-white/30 hover:bg-white/40 text-white font-bold rounded-xl transition-all">
                üôè Am√©m
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function fecharModalFesta() {
    const modal = document.getElementById('modal-festa');
    if (modal) modal.remove();
}

function mostrarNovenaHoje(novena) {
    const modal = document.createElement('div');
    modal.id = 'modal-novena';
    modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';
    modal.style.background = 'rgba(0,0,0,0.9)';
    
    modal.innerHTML = `
        <div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-600 rounded-3xl p-8 max-w-md w-full shadow-2xl">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">üìø</div>
                <h2 class="text-xl font-bold text-white">${novena.nome}</h2>
                <div class="flex items-center justify-center gap-2 mt-3">
                    ${Array.from({length: 9}, (_, i) => `
                        <div class="w-3 h-3 rounded-full ${i < novena.diaAtual ? 'bg-yellow-400' : 'bg-white/30'}"></div>
                    `).join('')}
                </div>
                <p class="text-white/80 mt-2">Dia ${novena.diaAtual} de 9</p>
            </div>
            
            <div class="bg-white/20 rounded-2xl p-5 mb-4">
                <h3 class="text-yellow-300 font-bold text-lg mb-2">${novena.conteudo.titulo}</h3>
                <p class="text-white leading-relaxed">${novena.conteudo.tema}</p>
            </div>
            
            <div class="bg-white/10 rounded-xl p-4 mb-6 text-center">
                <p class="text-white font-serif text-lg italic">"${novena.conteudo.oracao}"</p>
            </div>
            
            <div class="text-center text-white/60 text-sm mb-4">
                Prepara√ß√£o para: <strong class="text-white">${novena.festa?.nome}</strong>
            </div>
            
            <button onclick="fecharModalNovena()" class="w-full py-4 bg-white/30 hover:bg-white/40 text-white font-bold rounded-xl transition-all">
                üôè Completar Ora√ß√£o do Dia
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function fecharModalNovena() {
    const modal = document.getElementById('modal-novena');
    if (modal) modal.remove();
    showToast('‚ú® Ora√ß√£o do dia conclu√≠da!');
}

// ========================================
// üìø TER√áO GUIADO
// ========================================

function abrirTerco() {
    if (!window.TercoGuiado) {
        showToast('Carregando ter√ßo...');
        return;
    }
    
    const misterioDoDia = TercoGuiado.getMisterioDoDia();
    const misterios = TercoGuiado.misterios;
    const diasSemana = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
    const hoje = diasSemana[new Date().getDay()];
    
    const modal = document.createElement('div');
    modal.id = 'modal-escolha-terco';
    modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';
    modal.style.background = 'rgba(0,0,0,0.95)';
    
    modal.innerHTML = `
        <div class="bg-gradient-to-br from-purple-900 via-pink-900 to-rose-900 rounded-3xl p-6 max-w-md w-full shadow-2xl">
            <div class="text-center mb-6">
                <div class="text-6xl mb-3">üìø</div>
                <h2 class="text-2xl font-bold text-white">Santo Ter√ßo</h2>
                <p class="text-white/70 text-sm mt-1">${hoje} - ${misterios[misterioDoDia].nome}</p>
            </div>
            
            <!-- Mist√©rio do dia (destacado) -->
            <button onclick="iniciarTercoTipo('${misterioDoDia}')" class="w-full mb-4 p-4 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-2xl text-left hover:scale-[1.02] transition-transform">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-black/60 text-xs font-semibold uppercase">Mist√©rio do Dia</p>
                        <p class="text-black font-bold text-lg">${misterios[misterioDoDia].nome}</p>
                    </div>
                    <span class="text-3xl">‚ñ∂Ô∏è</span>
                </div>
            </button>
            
            <p class="text-white/50 text-xs text-center mb-3">Ou escolha outro mist√©rio:</p>
            
            <!-- Outros mist√©rios -->
            <div class="grid grid-cols-2 gap-2 mb-4">
                ${Object.entries(misterios).map(([key, m]) => `
                    <button onclick="iniciarTercoTipo('${key}')" class="p-3 rounded-xl text-left transition-all hover:scale-[1.02] ${key === misterioDoDia ? 'bg-yellow-500/20 border border-yellow-500/50' : 'bg-white/10 hover:bg-white/20'}">
                        <p class="text-white font-semibold text-sm">${m.nome.replace('Mist√©rios ', '')}</p>
                        <p class="text-white/50 text-xs">${m.dias.join(', ')}</p>
                    </button>
                `).join('')}
            </div>
            
            <button onclick="fecharEscolhaTerco()" class="w-full py-3 bg-white/10 text-white rounded-xl font-semibold hover:bg-white/20 transition-all">
                Cancelar
            </button>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function iniciarTercoTipo(tipo) {
    fecharEscolhaTerco();
    TercoGuiado.iniciar(tipo);
}

function fecharEscolhaTerco() {
    const modal = document.getElementById('modal-escolha-terco');
    if (modal) modal.remove();
}

// ========================================
// üïØÔ∏è SANTU√ÅRIO DE VELAS
// ========================================

function abrirSantuarioVelas() {
    if (window.SantuarioVelas) {
        SantuarioVelas.abrir();
    } else {
        showToast('Carregando santu√°rio...');
    }
}

// ========================================
// üë• MURAL DE INTEN√á√ïES
// ========================================

function abrirMuralIntencoes() {
    if (window.MuralIntencoes) {
        MuralIntencoes.abrir();
    } else {
        showToast('Carregando mural...');
    }
}

// ========================================
// üëë TELA PREMIUM
// ========================================

function abrirTelaPremium(motivo = null) {
    if (window.TelaPremium) {
        TelaPremium.abrir(motivo);
    } else {
        showToast('Carregando...');
    }
}

// Verificar e atualizar bot√£o premium
function atualizarBotaoPremium() {
    const btnPremium = document.getElementById('btn-premium');
    if (btnPremium && window.TelaPremium && TelaPremium.isPremium()) {
        btnPremium.innerHTML = '<span>üëë</span><span>Premium ‚úì</span>';
        btnPremium.classList.remove('bg-gradient-to-r', 'from-yellow-500', 'to-amber-500');
        btnPremium.classList.add('bg-green-600/80');
    }
}

// ========================================
// üîî PWA E NOTIFICA√á√ïES
// ========================================

async function initPWA() {
    if ('serviceWorker' in navigator) {
        try {
            const registration = await navigator.serviceWorker.register('sw.js');
            console.log('‚úÖ Service Worker registrado:', registration);
        } catch (error) {
            console.log('‚ùå Erro ao registrar SW:', error);
        }
    }
}

// Pedir permiss√£o de notifica√ß√£o
async function pedirPermissaoNotificacao() {
    if (!window.NotificationSystem) return false;
    
    const granted = await NotificationSystem.requestPermission();
    if (granted) {
        showToast('üîî Notifica√ß√µes ativadas! Voc√™ receber√° lembretes de ora√ß√£o.');
        document.getElementById('btn-notificacoes').innerHTML = 'üîî Notifica√ß√µes Ativas';
        document.getElementById('btn-notificacoes').classList.add('bg-green-600');
    }
    return granted;
}

// Testar notifica√ß√£o
function testarNotificacao() {
    if (window.NotificationSystem) {
        NotificationSystem.testNotification();
    }
}

// ========================================
// üìñ VERS√çCULO DO DIA
// ========================================

function getVersiculoDoDia() {
    if (window.NotificationSystem) {
        return NotificationSystem.getDailyVerse();
    }
    return {
        texto: "Fazei tudo o que Ele vos disser.",
        ref: "Jo√£o 2:5",
        reflexao: "Confie e obede√ßa, mesmo sem entender os planos de Deus."
    };
}

function mostrarVersiculoDoDia() {
    const verse = getVersiculoDoDia();
    const streak = getStreak();
    
    const modal = document.createElement('div');
    modal.id = 'modal-versiculo';
    modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';
    modal.style.background = 'rgba(0,0,0,0.9)';
    modal.innerHTML = `
        <div class="bg-gradient-to-br from-yellow-50 to-amber-100 rounded-3xl p-8 max-w-md w-full shadow-2xl transform animate-pulse-once">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">‚ú®</div>
                <h2 class="font-cursive text-4xl text-yellow-700 mb-2">Vers√≠culo do Dia</h2>
                <p class="text-sm text-gray-500">${new Date().toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
            </div>
            
            <div class="bg-white/80 rounded-2xl p-6 mb-6 shadow-inner">
                <p class="font-serif text-xl text-gray-800 italic leading-relaxed mb-3">"${verse.texto}"</p>
                <p class="text-right text-yellow-700 font-semibold">‚Äî ${verse.ref}</p>
            </div>
            
            <div class="bg-yellow-600/10 rounded-xl p-4 mb-6">
                <p class="text-sm text-gray-700"><strong class="text-yellow-700">üí≠ Reflex√£o:</strong> ${verse.reflexao}</p>
            </div>
            
            <div class="flex items-center justify-center gap-2 mb-6 p-3 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-xl text-white">
                <span class="text-2xl">üî•</span>
                <span class="font-bold text-lg">${streak} dias em ora√ß√£o!</span>
            </div>
            
            <button onclick="fecharModalVersiculo()" class="w-full py-4 bg-gradient-to-r from-yellow-600 to-amber-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all">
                üôè Come√ßar o Dia com Maria
            </button>
        </div>
    `;
    document.body.appendChild(modal);
}

function fecharModalVersiculo() {
    const modal = document.getElementById('modal-versiculo');
    if (modal) modal.remove();
}

// ========================================
// üî• STREAK - DIAS CONSECUTIVOS
// ========================================

function getStreak() {
    const data = localStorage.getItem('mariaStreak');
    if (!data) return 0;
    const { count, lastDate } = JSON.parse(data);
    return count || 0;
}

function updateStreak() {
    const today = new Date().toDateString();
    const data = localStorage.getItem('mariaStreak');
    let streak = { count: 1, lastDate: today };
    
    if (data) {
        const saved = JSON.parse(data);
        if (saved.lastDate === today) {
            // J√° contou hoje - s√≥ atualizar UI
            const streakEl = document.getElementById('streak-count');
            if (streakEl) streakEl.textContent = saved.count;
            
            // Sincronizar com EstatisticasOracao
            if (window.EstatisticasOracao) {
                EstatisticasOracao.atualizarStreak(saved.count);
            }
            return saved.count;
        }
        
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        
        if (saved.lastDate === yesterday.toDateString()) {
            streak.count = saved.count + 1; // Dia consecutivo!
        }
        // Se n√£o foi ontem, reseta para 1
    }
    
    localStorage.setItem('mariaStreak', JSON.stringify(streak));
    
    // Atualizar UI se existir
    const streakEl = document.getElementById('streak-count');
    if (streakEl) streakEl.textContent = streak.count;
    
    // Sincronizar com EstatisticasOracao
    if (window.EstatisticasOracao) {
        EstatisticasOracao.atualizarStreak(streak.count);
    }
    
    // Verificar status Premium
    setTimeout(atualizarBotaoPremium, 500);
    
    return streak.count;
}

// ========================================
// üçû TOAST NOTIFICATIONS
// ========================================

function showToast(message) {
    // Remover toast existente
    const existing = document.querySelector('.toast-notification');
    if (existing) existing.remove();
    
    const toast = document.createElement('div');
    toast.className = 'toast-notification fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg z-50 animate-fade-in';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}
</script>

<style>
@keyframes fade-in {
    from { opacity: 0; transform: translate(-50%, 20px); }
    to { opacity: 1; transform: translate(-50%, 0); }
}
.animate-fade-in { animation: fade-in 0.3s ease-out; }

@keyframes pulse-once {
    0% { transform: scale(0.9); opacity: 0; }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
}
.animate-pulse-once { animation: pulse-once 0.5s ease-out; }

/* Efeito de brilho no bot√£o de velas */
.vela-btn-glow {
    animation: vela-glow 2s ease-in-out infinite;
}

@keyframes vela-glow {
    0%, 100% { box-shadow: 0 0 5px rgba(255, 183, 77, 0.5); }
    50% { box-shadow: 0 0 15px rgba(255, 183, 77, 0.8), 0 0 25px rgba(255, 183, 77, 0.4); }
}

/* Efeito especial no bot√£o Premium */
.premium-btn-glow {
    animation: premium-glow 2s ease-in-out infinite;
    background-size: 200% 100%;
}

@keyframes premium-glow {
    0%, 100% { 
        box-shadow: 0 0 10px rgba(251, 191, 36, 0.6), 0 0 20px rgba(251, 191, 36, 0.3);
        background-position: 0% 0%;
    }
    50% { 
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.8), 0 0 40px rgba(251, 191, 36, 0.5);
        background-position: 100% 0%;
    }
}

</style>

</body>
</html>
