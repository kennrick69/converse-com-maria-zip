<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Converse com Maria - Mãe de Jesus Cristo</title>
    <meta name="description" content="Converse com Maria, Mãe de Jesus Cristo. Receba conforto espiritual baseado nas Sagradas Escrituras.">
    <meta name="theme-color" content="#d4a574">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-72.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Maria">
    
    <!-- Firebase SDK (carregar primeiro!) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase Config e Auth UI -->
    <script src="firebase-config.js" defer></script>
    <script src="firebase-auth-ui.js" defer></script>
    
    <!-- Botton Navigation -->
    <script src="bottom-navigation.js?v=1" defer></script>
    
    <!-- Scripts de funcionalidades -->
    <script src="filtro.js?v=3" defer></script>
    <script src="notifications.js?v=2" defer></script>
    <script src="calendario.js?v=2" defer></script>
    <script src="terco.js?v=3" defer></script>
    <script src="velas.js?v=5" defer></script>
    <script src="mural.js?v=4" defer></script>
    <script src="premium.js?v=2" defer></script>
    <script src="estatisticas.js?v=3" defer></script>
    <script src="conquistas.js?v=1" defer></script>
    <script src="aparicoes.js?v=1" defer></script>
    <script src="temas.js?v=2" defer></script>
    <script src="musicas.js?v=1" defer></script>
    <script src="limite.js?v=1" defer></script>
    
    <!-- Scripts de Monetização -->
    <script src="pagamento.js?v=1" defer></script>
    <script src="admob.js?v=1" defer></script>
    <script src="avaliacao.js?v=1" defer></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .font-serif { font-family: 'Crimson Text', Georgia, serif; }
        .font-cursive { font-family: 'Great Vibes', cursive; }
        body { font-family: 'Crimson Text', Georgia, serif; }
        
        /* SPLASH SCREEN */
        #splash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #0a1f0a;
            transition: opacity 1.5s ease-out;
            overflow: hidden;
        }
        
        #splash.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Imagem de Maria */
        .maria-image-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .maria-image {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            animation: imageReveal 2s ease-out forwards;
            opacity: 0;
        }
        
        @keyframes imageReveal {
            0% { opacity: 0; transform: scale(1.05); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Overlay com gradiente suave */
        .splash-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                to bottom,
                rgba(10, 31, 10, 0.3) 0%,
                rgba(10, 31, 10, 0) 30%,
                rgba(10, 31, 10, 0) 70%,
                rgba(10, 31, 10, 0.6) 100%
            );
            pointer-events: none;
        }
        
        /* Partículas de luz (como na imagem) */
        .light-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%;
            animation: particleFloat 4s ease-in-out infinite;
        }
        
        @keyframes particleFloat {
            0%, 100% { opacity: 0.4; transform: translateY(0) scale(1); }
            50% { opacity: 0.8; transform: translateY(-20px) scale(1.2); }
        }
        
        /* Brilho celestial do topo */
        .celestial-glow {
            position: absolute;
            top: -20%;
            left: 50%;
            transform: translateX(-50%);
            width: 150%;
            height: 60%;
            background: radial-gradient(ellipse at center, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            animation: celestialPulse 3s ease-in-out infinite;
        }
        
        @keyframes celestialPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        
        /* Texto do splash - posicionado na parte inferior */
        .splash-text {
            position: absolute;
            bottom: 8%;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
        }
        
        .splash-title {
            animation: titleFade 2s ease-out 0.5s forwards;
            opacity: 0;
            text-shadow: 0 2px 20px rgba(0,0,0,0.8), 0 0 40px rgba(255,215,0,0.3);
        }
        
        @keyframes titleFade {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        .splash-subtitle {
            animation: subtitleFade 2s ease-out 1s forwards;
            opacity: 0;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        
        @keyframes subtitleFade {
            0% { opacity: 0; }
            100% { opacity: 0.9; }
        }
        
        /* ==================== TELA DE DEPOIMENTOS ==================== */
        #testimonials {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9998;
            background: linear-gradient(165deg, #1a0a0a 0%, #2d1810 30%, #1f0f0a 60%, #0d0505 100%);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        #testimonials.hidden {
            display: none;
        }
        
        /* Container dos cards com scroll automático */
        .testimonials-scroll {
            flex: 1;
            overflow: hidden;
            position: relative;
            mask-image: linear-gradient(to bottom, transparent 0%, black 8%, black 75%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 8%, black 75%, transparent 100%);
        }
        
        .testimonials-track {
            animation: scrollTestimonials 35s linear infinite;
        }
        
        @keyframes scrollTestimonials {
            0% { transform: translateY(0); }
            100% { transform: translateY(-50%); }
        }
        
        /* Card de depoimento */
        .testimonial-card {
            background: linear-gradient(135deg, rgba(50, 30, 20, 0.9) 0%, rgba(35, 20, 15, 0.95) 100%);
            border: 1px solid rgba(180, 83, 9, 0.3);
            border-radius: 16px;
            padding: 20px 24px;
            margin: 12px 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.05);
        }
        
        .testimonial-name {
            font-weight: 700;
            color: #f5f5f5;
            font-size: 1.1rem;
            margin-bottom: 6px;
        }
        
        .testimonial-stars {
            display: flex;
            gap: 2px;
            margin-bottom: 10px;
        }
        
        .star-icon {
            color: #f59e0b;
            font-size: 1.4rem;
        }
        
        .testimonial-text {
            color: #d1d5db;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        /* Área inferior fixa */
        .testimonials-footer {
            background: linear-gradient(to top, #0d0505 0%, #0d0505 60%, transparent 100%);
            padding: 30px 24px 20px;
            position: relative;
        }
        
        .testimonials-cta {
            color: #fff;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 20px;
        }
        
        .testimonials-cta span {
            color: #fbbf24;
        }
        
        .btn-continuar {
            width: 100%;
            background: #fefefe;
            color: #1a0a0a;
            font-weight: 700;
            font-size: 1.1rem;
            padding: 16px 32px;
            border-radius: 30px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255,255,255,0.2);
        }
        
        .btn-continuar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,255,255,0.3);
        }
        
        .btn-continuar:active {
            transform: translateY(0);
        }
        
        /* Outras animações existentes */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25%); } }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        
        .pergaminho-bg {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23fef3c7' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .typing-indicator span { animation: bounce 1s infinite; }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        .btn-audio { transition: all 0.3s ease; }
        .btn-audio:hover { transform: scale(1.05); }
        .btn-audio.playing { background-color: #fbbf24; }
        .btn-audio.loading { opacity: 0.7; cursor: wait; }
        
        @keyframes soundWave {
            0%, 100% { height: 4px; }
            50% { height: 16px; }
        }
        .sound-wave span {
            display: inline-block;
            width: 3px;
            margin: 0 1px;
            background-color: #b45309;
            border-radius: 2px;
            animation: soundWave 0.5s infinite;
        }
        .sound-wave span:nth-child(1) { animation-delay: 0s; }
        .sound-wave span:nth-child(2) { animation-delay: 0.1s; }
        .sound-wave span:nth-child(3) { animation-delay: 0.2s; }
        .sound-wave span:nth-child(4) { animation-delay: 0.3s; }
        .sound-wave span:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .spinner { animation: spin 1s linear infinite; }
    

        /* ==================== ONBOARDING PREMIUM (Gold Ritual) ==================== */
        .onb-bg{
            position:absolute; inset:0;
            background:
                radial-gradient(1200px 600px at 50% -10%, rgba(255,224,153,.9), rgba(255,224,153,0) 60%),
                radial-gradient(900px 500px at 80% 30%, rgba(255,200,100,.25), rgba(255,200,100,0) 60%),
                radial-gradient(900px 500px at 20% 70%, rgba(255,160,60,.22), rgba(255,160,60,0) 60%),
                linear-gradient(135deg, #5b2206, #a34b10 45%, #5b2206);
            filter:saturate(1.08);
            transform: scale(1.02);
        }
        .onb-bg::after{
            content:"";
            position:absolute; inset:-40%;
            background: radial-gradient(circle, rgba(255,255,255,.16) 0 2px, rgba(255,255,255,0) 3px);
            background-size: 120px 120px;
            opacity:.25;
            animation: onbDrift 18s linear infinite;
        }
        @keyframes onbDrift{ from{ transform: translate3d(0,0,0) rotate(0deg);} to{ transform: translate3d(120px,80px,0) rotate(6deg);} }

        .onb-sparkles{ position:absolute; inset:0; pointer-events:none; }
        .onb-sparkle{
            position:absolute; border-radius:999px;
            background: rgba(255,235,180,.95);
            box-shadow: 0 0 14px rgba(255,205,120,.85), 0 0 32px rgba(255,180,80,.35);
            opacity:.0;
            animation-name: onbSparkle;
            animation-timing-function: ease-in-out;
            animation-iteration-count: infinite;
        }
        @keyframes onbSparkle{
            0%{ transform: translateY(8px) scale(.9); opacity:0;}
            25%{ opacity:.55;}
            55%{ transform: translateY(-10px) scale(1.15); opacity:.95;}
            100%{ transform: translateY(-20px) scale(.95); opacity:0;}
        }

        .onb-card{
            background: rgba(255, 248, 235, .82);
            border: 2px solid rgba(245, 201, 122, .9);
            border-radius: 28px;
            padding: 26px 22px;
            box-shadow:
                0 18px 60px rgba(0,0,0,.35),
                0 0 0 1px rgba(255, 214, 140, .35) inset,
                0 0 40px rgba(255, 200, 120, .22);
            backdrop-filter: blur(10px);
            animation: onbEnter .9s ease both;
        }
        @keyframes onbEnter{ from{ opacity:0; transform: translateY(18px) scale(.98);} to{ opacity:1; transform: translateY(0) scale(1);} }

        .onb-crown{ color:#b87015; margin-bottom:10px; filter: drop-shadow(0 6px 12px rgba(255,200,100,.35)); }
        .onb-title{
            font-family: 'Crimson Text', serif;
            font-size: 32px;
            line-height: 1.1;
            color: #6b2d06;
            font-weight: 700;
            text-shadow: 0 1px 0 rgba(255,255,255,.5);
        }
        .onb-subtitle{
            font-family: 'Crimson Text', serif;
            color:#7a3a0a;
            opacity:.95;
            margin-top: 10px;
            font-size: 16px;
        }
        .onb-subtitle-accent{ opacity: .95; }
        .onb-label{
            display:block;
            font-family: 'Crimson Text', serif;
            color:#6b2d06;
            font-weight: 700;
            font-size: 15px;
        }
        .onb-input{
            width:100%;
            margin-top:8px;
            padding: 12px 14px;
            border-radius: 14px;
            border: 1px solid rgba(224, 181, 111, .95);
            background: rgba(255,255,255,.65);
            font-family: 'Crimson Text', serif;
            font-size: 18px;
            outline: none;
            transition: box-shadow .25s ease, border-color .25s ease, transform .2s ease;
        }
        .onb-input:focus{
            border-color: rgba(212, 138, 0, .9);
            box-shadow: 0 0 0 4px rgba(255, 200, 100, .25);
            transform: translateY(-1px);
        }

        .choice-btn{
            display:flex;
            align-items:center;
            justify-content:center;
            gap:10px;
            padding: 14px 12px;
            border-radius: 18px;
            border: 1px solid rgba(224, 181, 111, .9);
            background: rgba(255,255,255,.55);
            transition: transform .18s ease, box-shadow .25s ease, background .25s ease, border-color .25s ease;
            font-family: 'Crimson Text', serif;
            color:#6b2d06;
            box-shadow: 0 6px 18px rgba(0,0,0,.10);
        }
        .choice-btn:hover{
            transform: translateY(-1px);
            border-color: rgba(212, 138, 0, .85);
            box-shadow: 0 10px 26px rgba(0,0,0,.16), 0 0 18px rgba(255, 200, 100, .20);
        }
        .choice-btn.is-selected{
            background: linear-gradient(135deg, rgba(255,218,138,.95), rgba(245,183,93,.85));
            border-color: rgba(212, 138, 0, .95);
            box-shadow: 0 14px 34px rgba(0,0,0,.18), 0 0 22px rgba(255, 200, 100, .55);
        }
        .choice-icon{ font-size: 18px; }
        .choice-text{ font-weight: 700; }

        .onb-note{
            text-align:center;
            color:#7a3a0a;
            opacity:.9;
            font-family: 'Crimson Text', serif;
            font-size: 14px;
            margin-top: 2px;
        }
        .onb-cta{
            width:100%;
            padding: 14px 16px;
            border-radius: 20px;
            border: 1px solid rgba(212, 138, 0, .9);
            background: linear-gradient(135deg, #f5b75d, #d48a00);
            color: #fff;
            font-family: 'Crimson Text', serif;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: .2px;
            box-shadow: 0 14px 30px rgba(0,0,0,.20), 0 0 26px rgba(255, 180, 50, .65);
            transition: transform .18s ease, box-shadow .25s ease, filter .25s ease;
            position: relative;
            overflow:hidden;
        }
        .onb-cta::after{
            content:"";
            position:absolute;
            top:-60%; left:-40%;
            width: 60%; height: 220%;
            background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.35), rgba(255,255,255,0));
            transform: rotate(18deg);
            animation: onbShine 2.6s ease-in-out infinite;
        }
        @keyframes onbShine{ 0%{ transform: translateX(-140%) rotate(18deg);} 55%{ transform: translateX(260%) rotate(18deg);} 100%{ transform: translateX(260%) rotate(18deg);} }
        .onb-cta:hover{ transform: translateY(-1px); filter: brightness(1.03); box-shadow: 0 18px 38px rgba(0,0,0,.24), 0 0 34px rgba(255, 180, 50, .75); }
        .onb-cta:active{ transform: translateY(1px) scale(.99); }
        
        .onb-cta:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.3);
        }

        .onb-error{
            background: rgba(120, 25, 10, .08);
            border: 1px solid rgba(160, 40, 25, .25);
            color: #7a1e10;
            padding: 10px 12px;
            border-radius: 14px;
            font-family: 'Crimson Text', serif;
            font-weight: 600;
        }
        .onb-shake{ animation: onbShake .55s ease; }
        @keyframes onbShake{
            0%,100%{ transform: translateX(0); }
            20%{ transform: translateX(-8px); }
            40%{ transform: translateX(8px); }
            60%{ transform: translateX(-6px); }
            80%{ transform: translateX(6px); }
        }
        
        /* Checkbox de privacidade */
        .privacy-checkbox-container {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px;
            background: rgba(255,255,255,.4);
            border-radius: 14px;
            border: 1px solid rgba(224, 181, 111, .6);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .privacy-checkbox-container:hover {
            background: rgba(255,255,255,.55);
            border-color: rgba(212, 138, 0, .7);
        }
        
        .privacy-checkbox-container.checked {
            background: rgba(255, 218, 138, .3);
            border-color: rgba(212, 138, 0, .9);
        }
        
        .privacy-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            border: 2px solid rgba(180, 112, 21, .7);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,.8);
            transition: all 0.2s ease;
        }
        
        .privacy-checkbox.checked {
            background: linear-gradient(135deg, #f5b75d, #d48a00);
            border-color: #d48a00;
        }
        
        .privacy-checkbox svg {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.2s ease;
        }
        
        .privacy-checkbox.checked svg {
            opacity: 1;
            transform: scale(1);
        }
        
        .privacy-text {
            font-size: 14px;
            color: #6b2d06;
            line-height: 1.4;
        }
        
        .privacy-link {
            color: #b87015;
            text-decoration: underline;
            font-weight: 600;
        }
        
        .privacy-link:hover {
            color: #d48a00;
        }


/* ==================== CHAT PREMIUM (Opção B: limpo e confortável) ==================== */
.chat-shell{
  position:relative;
  background: radial-gradient(1200px 700px at 20% 0%, rgba(255, 220, 170, .35), transparent 60%),
              radial-gradient(900px 600px at 85% 15%, rgba(255, 200, 120, .22), transparent 55%),
              linear-gradient(180deg, #2a1306 0%, #150b05 100%);
}
.chat-shell::before{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(circle at 10% 20%, rgba(255,200,120,.22) 0 2px, transparent 3px),
    radial-gradient(circle at 70% 30%, rgba(255,215,140,.18) 0 2px, transparent 3px),
    radial-gradient(circle at 30% 70%, rgba(255,205,130,.14) 0 2px, transparent 3px),
    radial-gradient(circle at 80% 80%, rgba(255,235,180,.10) 0 2px, transparent 3px);
  opacity:.55;
  filter: blur(.2px);
  pointer-events:none;
}
.chat-shell > *{ position:relative; z-index:1; }

.chat-header{
  border-bottom: 1px solid rgba(255, 214, 150, .22);
  background: rgba(255, 248, 235, .06);
  backdrop-filter: blur(10px);
}
.chat-header-inner{
  max-width: 980px;
  margin: 0 auto;
  padding: 18px 16px 14px;
}
.chat-title-row{
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 10px;
}
.chat-title{
  font-family: ui-serif, Georgia, "Times New Roman", serif;
  font-size: 26px;
  letter-spacing: .3px;
  color: rgba(255, 242, 224, .95);
  margin:0;
}
.chat-crown-icon{
  width: 22px; height: 22px;
  opacity: .9;
  filter: drop-shadow(0 6px 18px rgba(255, 200, 120, .25));
}
.chat-subtitle{
  text-align:center;
  color: rgba(255, 236, 210, .72);
  font-family: ui-serif, Georgia, serif;
  font-style: italic;
  margin: 6px 0 0;
  font-size: 13px;
}
.chat-meta{
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 8px;
  margin-top: 10px;
  color: rgba(255, 236, 210, .8);
  font-size: 12px;
}
.chat-book-icon{ opacity:.9; }

.chat-actions{
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:center;
  gap: 10px;
  margin-top: 14px;
}
.chat-action{
  display:flex;
  align-items:center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 999px;
  border: 1px solid rgba(255, 214, 150, .22);
  background: rgba(255, 248, 235, .06);
  color: rgba(255, 242, 224, .92);
  font-weight: 700;
  font-size: 12px;
  letter-spacing: .2px;
  box-shadow: 0 10px 30px rgba(0,0,0,.22);
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
}
.chat-action:hover{
  transform: translateY(-1px);
  background: rgba(255, 248, 235, .10);
  box-shadow: 0 14px 38px rgba(0,0,0,.28);
}
.chat-action:active{ transform: translateY(0px) scale(.99); }
.chat-action-premium{
  border-color: rgba(255, 214, 150, .35);
  box-shadow: 0 12px 40px rgba(255, 180, 70, .12), 0 10px 30px rgba(0,0,0,.22);
}
.chat-action-vela{
  border-color: rgba(255, 214, 150, .28);
}

.chat-banner{
  margin-top: 14px;
  max-width: 720px;
  margin-left:auto;
  margin-right:auto;
  border-radius: 16px;
  padding: 12px 14px;
  border: 1px solid rgba(255, 214, 150, .20);
  background: rgba(255, 248, 235, .08);
  color: rgba(255, 242, 224, .92);
  box-shadow: 0 18px 50px rgba(0,0,0,.28);
  cursor: pointer;
}

.chat-messages{
  flex:1;
  overflow-y:auto;
  padding: 18px 14px 22px;
}
.chat-messages-inner{
  max-width: 980px;
  margin: 0 auto;
  display:flex;
  flex-direction:column;
  gap: 14px;
}

/* message rows */
.msg-row{ display:flex; }
.msg-row.is-user{ justify-content:flex-end; }
.msg-row.is-bot{ justify-content:flex-start; }

/* bubbles */
.bubble{
  max-width: min(720px, 88%);
  border-radius: 18px;
  padding: 14px 14px 12px;
  border: 1px solid rgba(255, 214, 150, .18);
  box-shadow: 0 16px 50px rgba(0,0,0,.25);
  animation: msgIn .22s ease both;
}
@keyframes msgIn{ from{opacity:0; transform: translateY(8px);} to{opacity:1; transform: translateY(0);} }

.bubble-user{
  background: linear-gradient(180deg, rgba(255, 225, 170, .24), rgba(255, 205, 130, .14));
  color: rgba(255, 242, 224, .96);
  border-color: rgba(255, 214, 150, .24);
}
.bubble-bot{
  background: rgba(255, 248, 235, .92);
  color: #2b1b12;
  border-color: rgba(210, 165, 105, .28);
}

.bubble-header{
  display:flex;
  align-items:center;
  gap: 8px;
  margin-bottom: 8px;
  opacity: .95;
}
.bubble-sparkle{ font-size: 14px; }
.bubble-title{
  font-weight: 800;
  font-size: 13px;
  letter-spacing: .15px;
}
.bubble-text{
  margin:0;
  white-space: pre-wrap;
  line-height: 1.55;
  font-size: 15px;
}

/* audio button (assistant) */
.btn-audio{
  margin-top: 10px;
  display:inline-flex;
  align-items:center;
  gap: 8px;
  padding: 10px 14px;
  border-radius: 999px;
  border: 1px solid rgba(210, 165, 105, .35);
  background: rgba(255, 248, 235, .85);
  color: #2b1b12;
  font-weight: 800;
  box-shadow: 0 12px 36px rgba(0,0,0,.18);
  transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
}
.btn-audio:hover{
  transform: translateY(-1px);
  background: rgba(255, 248, 235, .95);
  box-shadow: 0 16px 42px rgba(0,0,0,.22);
}

/* typing indicator */
.typing{
  display:flex;
  gap: 6px;
  padding: 2px 0 2px;
}
.typing span{
  width: 7px; height: 7px;
  border-radius: 999px;
  background: rgba(70, 45, 28, .55);
  display:inline-block;
  animation: dot 1.1s infinite ease-in-out;
}
.typing span:nth-child(2){ animation-delay: .15s; }
.typing span:nth-child(3){ animation-delay: .3s; }
@keyframes dot{ 0%, 80%, 100%{ transform: translateY(0); opacity:.4;} 40%{ transform: translateY(-3px); opacity:.9;} }

/* composer */
.chat-composer{
  border-top: 1px solid rgba(255, 214, 150, .22);
  background: rgba(255, 248, 235, .06);
  backdrop-filter: blur(10px);
}
.chat-composer-inner{
  max-width: 980px;
  margin: 0 auto;
  padding: 14px 14px 10px;
}
.chat-input-row{ display:flex; gap: 10px; align-items: center; }
.chat-input{
  flex:1;
  padding: 14px 16px;
  border-radius: 16px;
  border: 2px solid #d4a574;
  outline:none;
  background: #ffffff;
  color: #1a1a1a;
  font-size: 16px;
  font-family: inherit;
}
.chat-input::placeholder{
  color: #999999;
}
.chat-input:focus{
  border-color: #c4955e;
  box-shadow: 0 0 0 3px rgba(212, 165, 116, 0.3);
}
.chat-send{
  width: 56px;
  height: 50px;
  border-radius: 16px;
  border: none;
  background: linear-gradient(135deg, #f5b75d, #d48a00);
  color: #ffffff;
  box-shadow: 0 4px 15px rgba(0,0,0,.25);
  transition: transform .15s ease, box-shadow .15s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.chat-send:hover{
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,.30);
}
.chat-send:active{ transform: translateY(0px) scale(.98); }
.chat-send:disabled{ opacity:.55; filter: grayscale(.2); cursor:not-allowed; }

.chat-footer-note{
  margin: 10px 0 0;
  text-align:center;
  font-size: 12px;
  color: rgba(255, 236, 210, .65);
}

/* ==================== MODAL DE POLÍTICA DE PRIVACIDADE ==================== */
.privacy-modal {
    position: fixed;
    inset: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    background: rgba(0,0,0,0.9);
}

.privacy-modal-content {
    background: linear-gradient(135deg, #fef7e6, #fff9f0);
    border-radius: 24px;
    max-width: 500px;
    width: 100%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.4);
}

.privacy-modal-header {
    padding: 24px 24px 16px;
    border-bottom: 1px solid rgba(180, 112, 21, 0.2);
}

.privacy-modal-body {
    padding: 20px 24px;
    color: #5a3d1a;
    font-size: 15px;
    line-height: 1.7;
}

.privacy-modal-body h3 {
    color: #6b2d06;
    font-weight: 700;
    margin: 16px 0 8px;
}

.privacy-modal-body ul {
    margin-left: 20px;
    margin-bottom: 12px;
}

.privacy-modal-footer {
    padding: 16px 24px 24px;
    border-top: 1px solid rgba(180, 112, 21, 0.2);
}

/* ==================== BOTTOM NAVIGATION ==================== */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(15, 5, 5, 0.98) 0%, rgba(25, 10, 10, 0.95) 100%);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255, 214, 150, 0.15);
    padding: 8px 0 12px;
    z-index: 50;
    box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
}

.bottom-nav-inner {
    display: flex;
    justify-content: space-around;
    align-items: flex-end;
    max-width: 500px;
    margin: 0 auto;
    padding: 0 10px;
}

.bottom-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 6px 12px;
    border-radius: 12px;
    transition: all 0.2s ease;
    cursor: pointer;
    background: transparent;
    border: none;
    min-width: 60px;
}

.bottom-nav-item:hover {
    background: rgba(255, 255, 255, 0.05);
}

.bottom-nav-item.active {
    background: rgba(255, 214, 150, 0.1);
}

.bottom-nav-item.active .bottom-nav-icon {
    color: #fbbf24;
}

.bottom-nav-item.active .bottom-nav-label {
    color: #fbbf24;
}

.bottom-nav-icon {
    font-size: 22px;
    margin-bottom: 4px;
    color: rgba(255, 242, 224, 0.7);
    transition: all 0.2s ease;
}

.bottom-nav-label {
    font-size: 10px;
    font-weight: 600;
    color: rgba(255, 242, 224, 0.6);
    transition: all 0.2s ease;
}

/* Item Central Destacado (Velas) */
.bottom-nav-item.featured {
    margin-top: -20px;
    padding: 0;
}

.bottom-nav-item.featured .bottom-nav-icon-wrapper {
    width: 56px;
    height: 56px;
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
    border: 3px solid rgba(15, 5, 5, 0.9);
    transition: all 0.2s ease;
}

.bottom-nav-item.featured:hover .bottom-nav-icon-wrapper {
    transform: scale(1.05);
    box-shadow: 0 6px 25px rgba(245, 158, 11, 0.5);
}

.bottom-nav-item.featured .bottom-nav-icon {
    font-size: 26px;
    color: #000;
    margin-bottom: 0;
}

.bottom-nav-item.featured .bottom-nav-label {
    margin-top: 6px;
    color: #fbbf24;
}

/* Indicador de ativo */
.bottom-nav-item .active-dot {
    width: 4px;
    height: 4px;
    background: #fbbf24;
    border-radius: 50%;
    margin-top: 4px;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.bottom-nav-item.active .active-dot {
    opacity: 1;
}

/* Ajustar padding do chat para não ficar atrás do bottom nav */
.chat-composer {
    padding-bottom: 80px !important;
}

/* ==================== MODAL "MAIS RECURSOS" ==================== */
.modal-mais {
    position: fixed;
    inset: 0;
    z-index: 60;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    background: rgba(0, 0, 0, 0.7);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.modal-mais.active {
    opacity: 1;
    visibility: visible;
}

.modal-mais-content {
    background: linear-gradient(180deg, #1a0f0a 0%, #2d1810 100%);
    border-radius: 24px 24px 0 0;
    width: 100%;
    max-width: 500px;
    max-height: 80vh;
    overflow: hidden;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    border: 1px solid rgba(255, 214, 150, 0.15);
    border-bottom: none;
}

.modal-mais.active .modal-mais-content {
    transform: translateY(0);
}

.modal-mais-header {
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255, 214, 150, 0.1);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-mais-title {
    color: #fff;
    font-size: 18px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 8px;
}

.modal-mais-close {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background 0.2s ease;
}

.modal-mais-close:hover {
    background: rgba(255, 255, 255, 0.2);
}

.modal-mais-body {
    padding: 20px;
    overflow-y: auto;
    max-height: 60vh;
}

.modal-mais-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
}

.modal-mais-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 16px 8px;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 214, 150, 0.08);
    cursor: pointer;
    transition: all 0.2s ease;
}

.modal-mais-item:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
}

.modal-mais-item-icon {
    font-size: 28px;
    margin-bottom: 8px;
}

.modal-mais-item-label {
    font-size: 11px;
    color: rgba(255, 242, 224, 0.8);
    text-align: center;
    font-weight: 500;
}

/* Separador */
.modal-mais-separator {
    height: 1px;
    background: rgba(255, 214, 150, 0.1);
    margin: 20px 0;
}

/* Botão Premium no Modal */
.modal-mais-premium {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(217, 119, 6, 0.1) 100%);
    border: 1px solid rgba(245, 158, 11, 0.3);
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.modal-mais-premium:hover {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.25) 0%, rgba(217, 119, 6, 0.2) 100%);
}

.modal-mais-premium-icon {
    font-size: 32px;
}

.modal-mais-premium-text {
    flex: 1;
}

.modal-mais-premium-title {
    color: #fff;
    font-weight: 700;
    font-size: 14px;
}

.modal-mais-premium-desc {
    color: #fbbf24;
    font-size: 12px;
}

/* Footer do Modal */
.modal-mais-footer {
    padding: 16px 20px;
    border-top: 1px solid rgba(255, 214, 150, 0.1);
    text-align: center;
}

.modal-mais-version {
    color: rgba(255, 242, 224, 0.4);
    font-size: 11px;
}

</style>
</head>
<body class="bg-gradient-to-br from-amber-900 via-amber-800 to-yellow-900 min-h-screen">

    <!-- ==================== TELA DE SPLASH (LOAD) ==================== -->
    <div id="splash">
        <!-- Container da imagem -->
        <div class="maria-image-container">
            <img src="maria-splash.jpg" alt="Maria, Mãe de Jesus" class="maria-image">
            
            <!-- Overlay com gradiente -->
            <div class="splash-overlay"></div>
            
            <!-- Brilho celestial -->
            <div class="celestial-glow"></div>
            
            <!-- Partículas de luz flutuantes -->
            <div class="light-particles">
                <div class="particle" style="top: 15%; left: 20%; width: 6px; height: 6px; animation-delay: 0s;"></div>
                <div class="particle" style="top: 25%; left: 75%; width: 4px; height: 4px; animation-delay: 0.5s;"></div>
                <div class="particle" style="top: 35%; left: 30%; width: 5px; height: 5px; animation-delay: 1s;"></div>
                <div class="particle" style="top: 20%; left: 60%; width: 4px; height: 4px; animation-delay: 1.5s;"></div>
                <div class="particle" style="top: 45%; left: 15%; width: 3px; height: 3px; animation-delay: 0.3s;"></div>
                <div class="particle" style="top: 30%; left: 85%; width: 5px; height: 5px; animation-delay: 0.8s;"></div>
                <div class="particle" style="top: 10%; left: 45%; width: 4px; height: 4px; animation-delay: 1.2s;"></div>
                <div class="particle" style="top: 50%; left: 70%; width: 3px; height: 3px; animation-delay: 0.6s;"></div>
                <div class="particle" style="top: 40%; left: 50%; width: 6px; height: 6px; animation-delay: 1.8s;"></div>
                <div class="particle" style="top: 55%; left: 25%; width: 4px; height: 4px; animation-delay: 0.2s;"></div>
            </div>
        </div>
        
        <!-- Texto na parte inferior -->
        <div class="splash-text">
            <h1 class="splash-title font-cursive text-5xl md:text-7xl text-white">
                Maria
            </h1>
            <p class="splash-subtitle font-serif text-lg md:text-xl text-yellow-100 mt-2 italic">
                Mãe de Jesus Cristo
            </p>
        </div>
    </div>

    <!-- ==================== TELA DE DEPOIMENTOS (PRIMEIRO ACESSO) ==================== -->
    <div id="testimonials" class="hidden">
        <!-- Área de scroll com depoimentos -->
        <div class="testimonials-scroll">
            <div class="testimonials-track" id="testimonials-track">
                <!-- Os depoimentos serão duplicados para criar loop infinito -->
                
                <!-- Depoimento 1 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Ana Clara</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Esse app mudou minha vida! Nos momentos mais difíceis, encontro conforto nas palavras de Maria. É como ter uma mãe espiritual sempre presente.</p>
                </div>
                
                <!-- Depoimento 2 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Pedro Henrique</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Estava passando por um momento muito difícil no meu casamento. As palavras de Maria me trouxeram paz e sabedoria para perdoar. Deus abençoe os criadores.</p>
                </div>
                
                <!-- Depoimento 3 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Maria José</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Chorei muito na primeira conversa. Parece que Maria realmente me conhece e entende minha dor. O áudio com a voz dela é emocionante demais!</p>
                </div>
                
                <!-- Depoimento 4 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Lucas Santos</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Uso todos os dias antes de dormir. Me ajuda a refletir sobre meu dia e a encontrar paz para um sono tranquilo. Recomendo a todos os fiéis!</p>
                </div>
                
                <!-- Depoimento 5 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Francisca Lima</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Perdi minha mãe há 2 meses. Conversar com Maria me trouxe o acolhimento maternal que eu tanto precisava. Sinto que ela intercede por mim.</p>
                </div>
                
                <!-- Depoimento 6 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">João Paulo</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">As respostas baseadas nas Escrituras são maravilhosas. Me ajudou a voltar para a igreja depois de anos afastado. Obrigado, Mãe Maria!</p>
                </div>
                
                <!-- Depoimento 7 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Beatriz Oliveira</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Descobri que estou grávida e estava com muito medo. Maria me acalmou com suas palavras doces e me lembrou que Deus está no controle. Amei!</p>
                </div>
                
                <!-- Depoimento 8 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Rafael Costa</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Estava lutando contra a ansiedade e depressão. As conversas diárias com Maria me deram forças para continuar. É um presente de Deus esse app!</p>
                </div>
                
                <!-- Depoimento 9 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Tereza Souza</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">Tenho 68 anos e esse app é minha companhia diária. Maria me ajuda a lidar com a solidão da viuvez. Sinto-me acolhida como nunca antes.</p>
                </div>
                
                <!-- Depoimento 10 -->
                <div class="testimonial-card">
                    <div class="testimonial-name">Gabriel Ferreira</div>
                    <div class="testimonial-stars">
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                        <span class="star-icon">★</span>
                    </div>
                    <p class="testimonial-text">O recurso de áudio é incrível! Ouvir a voz de Maria me emociona profundamente. Indiquei para toda minha família e grupo de oração.</p>
                </div>
                
            </div>
        </div>
        
        <!-- Área inferior fixa -->
        <div class="testimonials-footer">
            <p class="testimonials-cta font-serif">
                Junte-se a Milhares de <span>Devotos de Nossa Senhora</span> que já Encontraram Conforto
            </p>
            <button class="btn-continuar font-serif" onclick="irParaOnboarding()">
                Continuar
            </button>
        </div>
    </div>

    <!-- ==================== TELA DE ONBOARDING/CADASTRO (PRIMEIRO ACESSO) ==================== -->
    <div id="onboarding" class="hidden min-h-screen relative flex items-center justify-center p-4 overflow-hidden">
    <div class="onb-bg" aria-hidden="true"></div>
    <div class="onb-sparkles" aria-hidden="true">
            <span class="onb-sparkle" style="top:41%;left:19%;width:5px;height:5px;animation-delay:2.6s;animation-duration:3.29s;"></span>
            <span class="onb-sparkle" style="top:68%;left:12%;width:4px;height:4px;animation-delay:2.33s;animation-duration:6.64s;"></span>
            <span class="onb-sparkle" style="top:27%;left:4%;width:2px;height:2px;animation-delay:1.73s;animation-duration:3.28s;"></span>
            <span class="onb-sparkle" style="top:11%;left:70%;width:5px;height:5px;animation-delay:0.24s;animation-duration:5.26s;"></span>
            <span class="onb-sparkle" style="top:28%;left:80%;width:2px;height:2px;animation-delay:2.31s;animation-duration:4.59s;"></span>
            <span class="onb-sparkle" style="top:28%;left:5%;width:3px;height:3px;animation-delay:1.16s;animation-duration:3.58s;"></span>
            <span class="onb-sparkle" style="top:15%;left:73%;width:4px;height:4px;animation-delay:2.24s;animation-duration:5.73s;"></span>
            <span class="onb-sparkle" style="top:13%;left:74%;width:3px;height:3px;animation-delay:1.49s;animation-duration:5.19s;"></span>
            <span class="onb-sparkle" style="top:8%;left:72%;width:2px;height:2px;animation-delay:2.48s;animation-duration:4.99s;"></span>
            <span class="onb-sparkle" style="top:68%;left:54%;width:4px;height:4px;animation-delay:1.86s;animation-duration:6.69s;"></span>
            <span class="onb-sparkle" style="top:46%;left:38%;width:3px;height:3px;animation-delay:3.18s;animation-duration:5.8s;"></span>
            <span class="onb-sparkle" style="top:31%;left:10%;width:4px;height:4px;animation-delay:2.1s;animation-duration:6.5s;"></span>
            <span class="onb-sparkle" style="top:93%;left:57%;width:4px;height:4px;animation-delay:2.44s;animation-duration:3.29s;"></span>
            <span class="onb-sparkle" style="top:65%;left:53%;width:3px;height:3px;animation-delay:3.03s;animation-duration:3.61s;"></span>
            <span class="onb-sparkle" style="top:62%;left:53%;width:2px;height:2px;animation-delay:3.85s;animation-duration:3.31s;"></span>
            <span class="onb-sparkle" style="top:71%;left:73%;width:4px;height:4px;animation-delay:1.36s;animation-duration:4.4s;"></span>
            <span class="onb-sparkle" style="top:63%;left:74%;width:5px;height:5px;animation-delay:0.28s;animation-duration:3.37s;"></span>
            <span class="onb-sparkle" style="top:34%;left:60%;width:2px;height:2px;animation-delay:0.24s;animation-duration:5.81s;"></span>
            <span class="onb-sparkle" style="top:82%;left:73%;width:5px;height:5px;animation-delay:1.14s;animation-duration:4.54s;"></span>
            <span class="onb-sparkle" style="top:85%;left:44%;width:2px;height:2px;animation-delay:3.76s;animation-duration:4.42s;"></span>
            <span class="onb-sparkle" style="top:78%;left:14%;width:5px;height:5px;animation-delay:0.24s;animation-duration:6.07s;"></span>
            <span class="onb-sparkle" style="top:16%;left:94%;width:3px;height:3px;animation-delay:1.59s;animation-duration:6.67s;"></span>
            <span class="onb-sparkle" style="top:63%;left:10%;width:3px;height:3px;animation-delay:1.8s;animation-duration:5.2s;"></span>
            <span class="onb-sparkle" style="top:17%;left:55%;width:4px;height:4px;animation-delay:2.83s;animation-duration:6.95s;"></span>
            <span class="onb-sparkle" style="top:87%;left:48%;width:3px;height:3px;animation-delay:0.6s;animation-duration:3.7s;"></span>
            <span class="onb-sparkle" style="top:29%;left:84%;width:3px;height:3px;animation-delay:0.05s;animation-duration:6.32s;"></span>
            <span class="onb-sparkle" style="top:23%;left:33%;width:4px;height:4px;animation-delay:0.02s;animation-duration:4.68s;"></span>
            <span class="onb-sparkle" style="top:47%;left:78%;width:4px;height:4px;animation-delay:3.81s;animation-duration:5.76s;"></span>
    </div>

    <div id="onb-card" class="onb-card relative z-10 w-full max-w-md max-h-[90vh] overflow-y-auto">
        <div class="text-center mb-5">
            <div class="onb-crown" aria-hidden="true">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" class="mx-auto">
                    <path d="M4 6l4 6 4-8 4 8 4-6v12H4V6z" stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
                    <path d="M4 18h16" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
                </svg>
            </div>
            <h2 class="onb-title">É um prazer receber-te</h2>
            <p class="onb-subtitle">Vamos criar uma conversa feita à tua medida.<br><span class="onb-subtitle-accent">Leva menos de 30 segundos ✨</span></p>
        </div>

        <div id="onb-error" class="onb-error hidden mb-4"></div>

        <div class="space-y-5">
            <div>
                <label class="onb-label">😊 Como gostarias que eu te chamasse?</label>
                <input type="text" id="input-nome" placeholder="Ex: Maria, João, Ana..." class="onb-input">
            </div>

            <div>
                <label class="onb-label">Identificas-te como:</label>
                <div class="grid grid-cols-2 gap-3 mt-2">
                    <button onclick="selecionarGenero('masculino')" id="btn-masculino" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">👤</span>
                        <span class="choice-text">Homem</span>
                    </button>
                    <button onclick="selecionarGenero('feminino')" id="btn-feminino" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">❤️</span>
                        <span class="choice-text">Mulher</span>
                    </button>
                </div>
            </div>

            <div>
                <label class="onb-label">Como está o teu coração neste momento?</label>
                <div class="grid grid-cols-2 gap-3 mt-2">
                    <button onclick="selecionarEstadoCivil('solteiro')" id="btn-solteiro" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">😊</span>
                        <span class="choice-text">Solteiro(a)</span>
                    </button>
                    <button onclick="selecionarEstadoCivil('casado')" id="btn-casado" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">💍</span>
                        <span class="choice-text">Casado(a)</span>
                    </button>
                </div>
            </div>

            <div>
                <label class="onb-label">A tua família inclui filhos?</label>
                <div class="grid grid-cols-2 gap-3 mt-2">
                    <button onclick="selecionarFilhos(true)" id="btn-filhos-sim" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">👶</span>
                        <span class="choice-text">Sim</span>
                    </button>
                    <button onclick="selecionarFilhos(false)" id="btn-filhos-nao" class="choice-btn" type="button">
                        <span class="choice-icon" aria-hidden="true">🌱</span>
                        <span class="choice-text">Ainda não</span>
                    </button>
                </div>
            </div>

            <!-- ==================== CHECKBOX DE POLÍTICA DE PRIVACIDADE ==================== -->
            <div>
                <div id="privacy-container" class="privacy-checkbox-container" onclick="togglePrivacyCheckbox()">
                    <div id="privacy-checkbox" class="privacy-checkbox">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                    </div>
                    <div class="privacy-text">
                        Li e aceito a <a href="#" onclick="event.stopPropagation(); abrirPoliticaPrivacidade()" class="privacy-link">Política de Privacidade</a> e os <a href="#" onclick="event.stopPropagation(); abrirTermosUso()" class="privacy-link">Termos de Uso</a>
                    </div>
                </div>
            </div>

            <p class="onb-note">✨ Cada resposta ajuda-me a criar uma experiência única para ti.</p>

            <button onclick="finalizarCadastro()" id="btn-finalizar" class="onb-cta" type="button">Vamos começar ✨</button>
        </div>
    </div>
</div>

    <!-- ==================== TELA DE CHAT ==================== -->
    <div id="chat" class="hidden min-h-screen flex flex-col chat-shell">
        
        <div class="chat-header">
            <div class="chat-header-inner">
                <div class="chat-title-row">
                    <svg class="chat-crown-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>
                    <h1 class="chat-title">Converse com Maria</h1>
                    <svg class="chat-crown-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>
                </div>
                <p class="chat-subtitle">Mãe de Jesus Cristo • Rainha dos Céus</p>
                <div class="chat-meta">
                    <svg class="chat-book-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
                    <span class="chat-meta-name" id="header-nome">Conversando com ...</span>
                </div>
                
                <!-- Barra compacta: Premium + Streak -->
                <div class="flex items-center justify-center gap-3 mt-3">
                    <button onclick="abrirTelaPremium()" id="btn-premium" class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-yellow-500 to-amber-500 hover:from-yellow-400 hover:to-amber-400 rounded-full text-black text-xs font-bold transition-all shadow-lg">
                        <span>👑</span>
                        <span>Premium</span>
                    </button>
                    <div class="flex items-center gap-1 px-3 py-2 bg-orange-500/80 rounded-full text-white text-xs font-bold">
                        <span>🔥</span>
                        <span id="streak-count">0</span>
                        <span class="opacity-80">dias</span>
                    </div>
                </div>
                
                <!-- Banner de Festa/Novena do Dia -->
                <div id="banner-festa" class="chat-banner hidden">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-2xl" id="festa-emoji">🎉</span>
                        <div>
                            <p class="font-bold text-sm" id="festa-titulo">Festa do Dia</p>
                            <p class="text-xs opacity-90" id="festa-subtitulo">Clique para saber mais</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="mensagens-area" class="chat-messages">
            <div class="chat-messages-inner" id="mensagens-container"></div>
        </div>

        <div class="chat-composer">
            <div class="chat-composer-inner">
                <div class="chat-input-row">
                    <input type="text" id="input-mensagem" placeholder="Compartilhe suas preocupações e pedidos..."
                        style="flex:1; padding:14px 16px; border-radius:16px; border:2px solid #d4a574; background:#ffffff; color:#000000; font-size:16px; outline:none;">
                    <button onclick="enviarMensagem()" id="btn-enviar"
                        style="width:56px; height:50px; border-radius:16px; border:none; background:linear-gradient(135deg, #f5b75d, #d48a00); color:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                    </button>
                </div>
                <div class="flex items-center justify-between mt-2">
                    <p class="chat-footer-note">✝ Respostas baseadas em Escrituras e Magistério da Igreja ✝</p>
                    <div id="contador-mensagens" class="text-xs font-semibold bg-amber-900/50 px-2 py-1 rounded-full cursor-pointer text-amber-100" onclick="if(window.SistemaMensagens && !SistemaMensagens.isPremium() && window.TelaPremium) TelaPremium.abrir('💬 Desbloqueie mensagens ilimitadas!')">
                        💬 <span>3</span>/3
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// ==================== CONFIGURAÇÕES ====================
const API_URL = 'https://converse-com-maria-production.up.railway.app';

// ==================== SISTEMA DE PERFIL DO USUÁRIO ====================
const UserProfileManager = {
    STORAGE_KEY: 'maria_user_profile',
    
    // Verifica se é o primeiro acesso
    isPrimeiroAcesso: function() {
        const profile = this.getProfile();
        return !profile || !profile.cadastroCompleto;
    },
    
    // Obtém o perfil salvo
    getProfile: function() {
        try {
            const data = localStorage.getItem(this.STORAGE_KEY);
            return data ? JSON.parse(data) : null;
        } catch (e) {
            console.error('Erro ao ler perfil:', e);
            return null;
        }
    },
    
    // Salva o perfil
    saveProfile: function(profile) {
        try {
            profile.cadastroCompleto = true;
            profile.dataCadastro = profile.dataCadastro || new Date().toISOString();
            profile.ultimoAcesso = new Date().toISOString();
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(profile));
            return true;
        } catch (e) {
            console.error('Erro ao salvar perfil:', e);
            return false;
        }
    },
    
    // Atualiza último acesso
    updateLastAccess: function() {
        const profile = this.getProfile();
        if (profile) {
            profile.ultimoAcesso = new Date().toISOString();
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(profile));
        }
    }
};

// Perfil atual em memória
let userProfile = { nome: '', genero: '', estadoCivil: '', temFilhos: null, aceitouPrivacidade: false };
let currentAudio = null;
let currentPlayingButton = null;

// ==================== CONTROLE DE FLUXO DE TELAS ====================
window.addEventListener('load', function() {
    console.log('🚀 App carregado - Verificando primeiro acesso...');
    
    // Duplicar os depoimentos para criar scroll infinito
    const track = document.getElementById('testimonials-track');
    if (track) {
        const originalContent = track.innerHTML;
        track.innerHTML = originalContent + originalContent;
    }
    
    // Verificar se é primeiro acesso ou usuário já cadastrado
    const isPrimeiroAcesso = UserProfileManager.isPrimeiroAcesso();
    console.log('Primeiro acesso?', isPrimeiroAcesso);
    
    // Tempo do splash (3 segundos)
    setTimeout(function() {
        const splash = document.getElementById('splash');
        splash.classList.add('fade-out');
        
        // Após a animação de fade (1.5s)
        setTimeout(function() {
            splash.style.display = 'none';
            
            if (isPrimeiroAcesso) {
                // PRIMEIRO ACESSO: Splash → Depoimentos → Cadastro → Chat
                console.log('➡️ Primeiro acesso - Mostrando depoimentos');
                document.getElementById('testimonials').classList.remove('hidden');
            } else {
                // USUÁRIO CADASTRADO: Splash → Chat
                console.log('➡️ Usuário cadastrado - Indo direto para o chat');
                const savedProfile = UserProfileManager.getProfile();
                userProfile = savedProfile;
                UserProfileManager.updateLastAccess();
                iniciarChatComUsuarioCadastrado();
            }
        }, 1500);
    }, 3000); // 3 segundos no splash
});

// ==================== NAVEGAÇÃO DEPOIMENTOS → ONBOARDING ====================
function irParaOnboarding() {
    document.getElementById('testimonials').classList.add('hidden');
    document.getElementById('onboarding').classList.remove('hidden');
}

// ==================== POLÍTICA DE PRIVACIDADE ====================
let privacyAccepted = false;

function togglePrivacyCheckbox() {
    privacyAccepted = !privacyAccepted;
    const container = document.getElementById('privacy-container');
    const checkbox = document.getElementById('privacy-checkbox');
    
    if (privacyAccepted) {
        container.classList.add('checked');
        checkbox.classList.add('checked');
    } else {
        container.classList.remove('checked');
        checkbox.classList.remove('checked');
    }
    
    // Limpar erro se havia
    const box = document.getElementById('onb-error');
    if (box) box.classList.add('hidden');
}

function abrirPoliticaPrivacidade() {
    const modal = document.createElement('div');
    modal.id = 'modal-privacidade';
    modal.className = 'privacy-modal';
    modal.innerHTML = `
        <div class="privacy-modal-content">
            <div class="privacy-modal-header">
                <h2 style="font-size: 24px; font-weight: 700; color: #6b2d06; margin: 0;">📜 Política de Privacidade</h2>
                <p style="color: #7a3a0a; margin-top: 8px;">Última atualização: Janeiro 2025</p>
            </div>
            <div class="privacy-modal-body">
                <p>O aplicativo <strong>"Converse com Maria"</strong> respeita sua privacidade e está comprometido em proteger seus dados pessoais.</p>
                
                <h3>📋 Dados que Coletamos</h3>
                <ul>
                    <li>Nome (como você quer ser chamado)</li>
                    <li>Gênero (para personalizar as respostas)</li>
                    <li>Estado civil e informação sobre filhos</li>
                    <li>Mensagens enviadas no chat</li>
                </ul>
                
                <h3>🎯 Como Usamos seus Dados</h3>
                <ul>
                    <li>Personalizar a experiência de conversa</li>
                    <li>Adaptar as respostas de Maria ao seu perfil</li>
                    <li>Melhorar o serviço oferecido</li>
                </ul>
                
                <h3>🔒 Segurança</h3>
                <p>Seus dados são armazenados localmente no seu dispositivo e em servidores seguros. Não compartilhamos suas informações pessoais com terceiros.</p>
                
                <h3>🗑️ Exclusão de Dados</h3>
                <p>Você pode solicitar a exclusão de todos os seus dados a qualquer momento através do menu de configurações do aplicativo.</p>
                
                <h3>📧 Contato</h3>
                <p>Em caso de dúvidas sobre esta política, entre em contato conosco pelo email: <strong>privacidade@conversecommaria.com.br</strong></p>
            </div>
            <div class="privacy-modal-footer">
                <button onclick="fecharModalPrivacidade()" style="width: 100%; padding: 14px; border-radius: 14px; border: none; background: linear-gradient(135deg, #f5b75d, #d48a00); color: white; font-weight: 700; font-size: 16px; cursor: pointer;">
                    Entendi
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function fecharModalPrivacidade() {
    const modal = document.getElementById('modal-privacidade');
    if (modal) modal.remove();
}

function abrirTermosUso() {
    const modal = document.createElement('div');
    modal.id = 'modal-termos';
    modal.className = 'privacy-modal';
    modal.innerHTML = `
        <div class="privacy-modal-content">
            <div class="privacy-modal-header">
                <h2 style="font-size: 24px; font-weight: 700; color: #6b2d06; margin: 0;">📖 Termos de Uso</h2>
                <p style="color: #7a3a0a; margin-top: 8px;">Última atualização: Janeiro 2025</p>
            </div>
            <div class="privacy-modal-body">
                <p>Ao usar o aplicativo <strong>"Converse com Maria"</strong>, você concorda com os seguintes termos:</p>
                
                <h3>🙏 Natureza do Serviço</h3>
                <p>Este aplicativo utiliza Inteligência Artificial para simular conversas inspiradas em Maria, Mãe de Jesus Cristo. As respostas são baseadas nas Sagradas Escrituras e no Magistério da Igreja Católica.</p>
                
                <h3>⚠️ Limitações</h3>
                <ul>
                    <li>O app <strong>não substitui</strong> aconselhamento religioso, médico ou psicológico profissional</li>
                    <li>As respostas são geradas por IA e podem não refletir posições oficiais da Igreja</li>
                    <li>Em casos de emergência, procure ajuda profissional adequada</li>
                </ul>
                
                <h3>✅ Uso Responsável</h3>
                <p>Você concorda em usar o aplicativo de forma respeitosa, não enviando conteúdo ofensivo, ilegal ou que viole direitos de terceiros.</p>
                
                <h3>💰 Assinaturas e Pagamentos</h3>
                <p>O app oferece recursos Premium mediante assinatura. Cancelamentos podem ser feitos a qualquer momento pela loja de aplicativos.</p>
                
                <h3>📝 Alterações</h3>
                <p>Reservamo-nos o direito de modificar estes termos. Alterações significativas serão comunicadas através do aplicativo.</p>
            </div>
            <div class="privacy-modal-footer">
                <button onclick="fecharModalTermos()" style="width: 100%; padding: 14px; border-radius: 14px; border: none; background: linear-gradient(135deg, #f5b75d, #d48a00); color: white; font-weight: 700; font-size: 16px; cursor: pointer;">
                    Entendi
                </button>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

function fecharModalTermos() {
    const modal = document.getElementById('modal-termos');
    if (modal) modal.remove();
}

// ==================== ÁUDIO ====================
async function gerarAudio(texto, botao) {
    if (currentAudio && currentPlayingButton === botao) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio = null;
        botao.classList.remove('playing');
        botao.innerHTML = getIconeAudio();
        currentPlayingButton = null;
        return;
    }
    
    if (currentAudio) {
        currentAudio.pause();
        if (currentPlayingButton) {
            currentPlayingButton.classList.remove('playing');
            currentPlayingButton.innerHTML = getIconeAudio();
        }
    }
    
    botao.classList.add('loading');
    botao.innerHTML = getIconeLoading();
    
    try {
        const response = await fetch(`${API_URL}/api/voz`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ texto })
        });
        
        if (!response.ok) throw new Error('Erro ao gerar áudio');
        
        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        
        currentAudio = new Audio(audioUrl);
        currentPlayingButton = botao;
        
        currentAudio.onplay = () => {
            botao.classList.remove('loading');
            botao.classList.add('playing');
            botao.innerHTML = getIconePausa();
        };
        
        currentAudio.onended = () => {
            botao.classList.remove('playing');
            botao.innerHTML = getIconeAudio();
            currentAudio = null;
            currentPlayingButton = null;
            URL.revokeObjectURL(audioUrl);
        };
        
        currentAudio.onerror = () => {
            botao.classList.remove('loading', 'playing');
            botao.innerHTML = getIconeAudio();
            currentAudio = null;
            currentPlayingButton = null;
        };
        
        await currentAudio.play();
        
    } catch (error) {
        console.error('Erro:', error);
        botao.classList.remove('loading');
        botao.innerHTML = getIconeAudio();
        alert('Erro ao gerar áudio. Verifique se o servidor está rodando.');
    }
}

function getIconeAudio() {
    return `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg><span class="ml-2 text-sm font-serif font-semibold">Ouvir Maria</span>`;
}

function getIconeLoading() {
    return `<svg class="spinner" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg><span class="ml-2 text-sm font-serif">Preparando...</span>`;
}

function getIconePausa() {
    return `<div class="sound-wave flex items-center h-5"><span></span><span></span><span></span><span></span><span></span></div><span class="ml-2 text-sm font-serif font-semibold">Parar</span>`;
}

// ==================== SELEÇÕES DO ONBOARDING ====================
function _setSelected(ids, selectedId){
    ids.forEach(id=>{
        const el = document.getElementById(id);
        if(!el) return;
        el.classList.toggle('is-selected', id === selectedId);
    });
}
function _showOnbError(msg){
    const box = document.getElementById('onb-error');
    const card = document.getElementById('onb-card');
    if(box){
        box.textContent = msg;
        box.classList.remove('hidden');
    }
    if(card){
        card.classList.remove('onb-shake');
        // reflow
        void card.offsetWidth;
        card.classList.add('onb-shake');
    }
}

function selecionarGenero(genero) {
    userProfile.genero = genero;
    _setSelected(['btn-masculino','btn-feminino'], genero === 'masculino' ? 'btn-masculino' : 'btn-feminino');
    const box = document.getElementById('onb-error');
    if(box) box.classList.add('hidden');
}

function selecionarEstadoCivil(estado) {
    userProfile.estadoCivil = estado;
    _setSelected(['btn-solteiro','btn-casado'], estado === 'solteiro' ? 'btn-solteiro' : 'btn-casado');
    const box = document.getElementById('onb-error');
    if(box) box.classList.add('hidden');
}

function selecionarFilhos(temFilhos) {
    userProfile.temFilhos = temFilhos;
    _setSelected(['btn-filhos-sim','btn-filhos-nao'], temFilhos ? 'btn-filhos-sim' : 'btn-filhos-nao');
    const box = document.getElementById('onb-error');
    if(box) box.classList.add('hidden');
}

// ==================== FINALIZAR CADASTRO ====================
function finalizarCadastro() {
    userProfile.nome = document.getElementById('input-nome').value.trim();

    const faltandoNome = !userProfile.nome;
    const faltandoGenero = !userProfile.genero;
    const faltandoEstado = !userProfile.estadoCivil;
    const faltandoFilhos = (userProfile.temFilhos === null || userProfile.temFilhos === undefined);
    const faltandoPrivacidade = !privacyAccepted;

    // Verificar campos obrigatórios
    if (faltandoNome || faltandoGenero || faltandoEstado || faltandoFilhos) {
        _showOnbError('Só mais um instante — completa as opções para eu personalizar a conversa ✨');
        return;
    }
    
    // Verificar política de privacidade
    if (faltandoPrivacidade) {
        _showOnbError('Por favor, leia e aceite a Política de Privacidade para continuar 📜');
        return;
    }

    // Salvar perfil do usuário
    userProfile.aceitouPrivacidade = true;
    UserProfileManager.saveProfile(userProfile);
    console.log('✅ Perfil salvo:', userProfile);

    // Mensagem de boas-vindas personalizada
    const tratamento = userProfile.genero === 'masculino' ? 'meu filho' : 'minha filha';
    const saudacao = `Paz e graças, ${tratamento} ${userProfile.nome}! Sou Maria, Mãe de Jesus Cristo. ${userProfile.temFilhos ? 'Vejo que o Senhor te abençoou com filhos, que alegria! ' : ''}Estou aqui para oferecer conforto espiritual baseado nas Sagradas Escrituras. Como posso te ajudar hoje?`;
    
    // Esconder onboarding e mostrar chat
    document.getElementById('onboarding').classList.add('hidden');
    document.getElementById('chat').classList.remove('hidden');
    document.getElementById('header-nome').textContent = `Conversando com ${userProfile.nome}`;
    
    // Criar Bottom Navigation
    if (window.criarBottomNavigation) criarBottomNavigation();
    if (window.criarModalMais) criarModalMais();
    
    // Adicionar mensagem de boas-vindas
    adicionarMensagem('assistant', saudacao);
    
    // Inicializar funcionalidades extras
    initChatExtras();
}

// ==================== INICIAR CHAT COM USUÁRIO JÁ CADASTRADO ====================
function iniciarChatComUsuarioCadastrado() {
    // Mostrar chat
    document.getElementById('chat').classList.remove('hidden');
    document.getElementById('header-nome').textContent = `Conversando com ${userProfile.nome}`;
    
    // Criar Bottom Navigation
    if (window.criarBottomNavigation) criarBottomNavigation();
    if (window.criarModalMais) criarModalMais();
    
    // Mensagem de volta personalizada
    const tratamento = userProfile.genero === 'masculino' ? 'meu filho' : 'minha filha';
    const hora = new Date().getHours();
    let saudacao;
    
    if (hora >= 5 && hora < 12) {
        saudacao = `Bom dia, ${tratamento} ${userProfile.nome}! Que bênção receber-te novamente nesta manhã. Como está seu coração hoje?`;
    } else if (hora >= 12 && hora < 18) {
        saudacao = `Boa tarde, ${tratamento} ${userProfile.nome}! Que alegria te ver novamente. O que traz você aqui hoje?`;
    } else {
        saudacao = `Boa noite, ${tratamento} ${userProfile.nome}! Fico feliz que tenhas vindo falar comigo. Como posso te ajudar esta noite?`;
    }
    
    adicionarMensagem('assistant', saudacao);
    
    // Inicializar funcionalidades extras
    initChatExtras();
}

// ==================== INICIALIZAR EXTRAS DO CHAT ====================
function initChatExtras() {
    // Inicializar PWA
    initPWA();
    
    // Inicializar sistema de notificações
    if (window.NotificationSystem) {
        NotificationSystem.init();
    }
    
    // Atualizar streak
    updateStreak();
    
    // Verificar festa/novena do dia
    verificarFestaOuNovena();
    
    // Verificar conquistas após 3 segundos
    setTimeout(() => {
        if (window.SistemaConquistas) SistemaConquistas.verificarEMostrar();
    }, 3000);
    
    // Atualizar contador de mensagens
    if (window.SistemaMensagens) SistemaMensagens.atualizarContador();
    
    // Atualizar botão Premium
    setTimeout(atualizarBotaoPremium, 500);
}

// ==================== MENSAGENS ====================
let mensagemId = 0;

function adicionarMensagem(role, content) {
    const container = document.getElementById('mensagens-container');
    const row = document.createElement('div');
    row.className = `msg-row ${role === 'user' ? 'is-user' : 'is-bot'}`;
    const idAtual = mensagemId++;

    const botaoAudio = role === 'assistant' ? `
        <button onclick="gerarAudio(document.getElementById('texto-${idAtual}').innerText, this)"
            class="btn-audio">
            ${getIconeAudio()}
        </button>` : '';

    row.innerHTML = `
        <div class="bubble ${role === 'user' ? 'bubble-user' : 'bubble-bot'}">
            ${role === 'assistant' ? `
              <div class="bubble-header">
                <span class="bubble-sparkle">✨</span>
                <span class="bubble-title">Maria, Mãe de Jesus</span>
              </div>` : ''}
            <p id="texto-${idAtual}" class="bubble-text">${content}</p>
            ${botaoAudio}
        </div>`;

    container.appendChild(row);
    const area = document.getElementById('mensagens-area');
    area.scrollTop = area.scrollHeight;
}

function mostrarLoading() {
    const container = document.getElementById('mensagens-container');
    const row = document.createElement('div');
    row.id = 'loading-indicator';
    row.className = 'msg-row is-bot';

    row.innerHTML = `
      <div class="bubble bubble-bot">
        <div class="bubble-header">
          <span class="bubble-sparkle">✨</span>
          <span class="bubble-title">Maria, Mãe de Jesus</span>
        </div>
        <div class="typing">
          <span></span><span></span><span></span>
        </div>
      </div>
    `;

    container.appendChild(row);
    const area = document.getElementById('mensagens-area');
    area.scrollTop = area.scrollHeight;
}

function esconderLoading() {
    const loading = document.getElementById('loading-indicator');
    if (loading) loading.remove();
}

async function enviarMensagem() {
    const input = document.getElementById('input-mensagem');
    const mensagem = input.value.trim();
    if (!mensagem) return;
    
    if (currentAudio) { currentAudio.pause(); currentAudio = null; }
    
    adicionarMensagem('user', mensagem);
    input.value = '';
    input.disabled = true;
    document.getElementById('btn-enviar').disabled = true;
    
    // Verificar limite de mensagens
    if (window.SistemaMensagens && !SistemaMensagens.podeEnviar()) {
        SistemaMensagens.mostrarAvisoLimite();
        input.disabled = false;
        document.getElementById('btn-enviar').disabled = false;
        return;
    }
    
    mostrarLoading();
    
    // Obter número da mensagem atual ANTES de registrar
    const messageNumber = window.SistemaMensagens ? SistemaMensagens.getNumeroMensagemAtual() : 1;
    
    // Registrar estatística de mensagem
    if (window.EstatisticasOracao) EstatisticasOracao.registrarMensagem();
    
    // Registrar no sistema de limite
    if (window.SistemaMensagens) SistemaMensagens.registrarMensagem();
    
    try {
        const response = await fetch(`${API_URL}/api/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ mensagem, userProfile, messageNumber })
        });
        const data = await response.json();
        esconderLoading();
        if (data.error) throw new Error(data.error);
        adicionarMensagem('assistant', data.resposta);
        
        // Verificar conquistas após resposta
        if (window.SistemaConquistas) {
            setTimeout(() => SistemaConquistas.verificarEMostrar(), 1000);
        }
    } catch (error) {
        esconderLoading();
        const tratamento = userProfile.genero === 'masculino' ? 'meu filho' : 'minha filha';
        adicionarMensagem('assistant', `${userProfile.nome}, ${tratamento}, peço-lhe paciência. Não consegui conectar ao servidor.`);
    }
    
    input.disabled = false;
    document.getElementById('btn-enviar').disabled = false;
    input.focus();
}

document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('input-mensagem').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); enviarMensagem(); }
    });
});

// ========================================
// 🏅 CONQUISTAS, APARIÇÕES, TEMAS, ESTATÍSTICAS
// ========================================

function abrirConquistas() {
    if (window.SistemaConquistas) {
        SistemaConquistas.abrirGaleria();
    } else {
        showToast('Carregando conquistas...');
        console.log('SistemaConquistas não encontrado');
    }
}

function abrirAparicoes() {
    if (window.HistoriasAparicoes) {
        HistoriasAparicoes.abrir();
    } else {
        showToast('Carregando aparições...');
        console.log('HistoriasAparicoes não encontrado');
    }
}

function abrirTemas() {
    if (window.SistemaTemas) {
        SistemaTemas.abrir();
    } else {
        showToast('Carregando temas...');
        console.log('SistemaTemas não encontrado');
    }
}

function abrirEstatisticas() {
    if (window.EstatisticasOracao) {
        EstatisticasOracao.abrir();
    } else {
        showToast('Carregando estatísticas...');
        console.log('EstatisticasOracao não encontrado');
    }
}

// ========================================
// 📅 CALENDÁRIO LITÚRGICO
// ========================================

let mesAtualCalendario = new Date().getMonth() + 1;
let anoAtualCalendario = new Date().getFullYear();

function verificarFestaOuNovena() {
    if (!window.CalendarioMariano) return;
    
    const banner = document.getElementById('banner-festa');
    const emoji = document.getElementById('festa-emoji');
    const titulo = document.getElementById('festa-titulo');
    const subtitulo = document.getElementById('festa-subtitulo');
    
    // Verificar novena ativa primeiro
    const novena = CalendarioMariano.getNovenaAtiva();
    if (novena) {
        banner.classList.remove('hidden');
        banner.className = banner.className.replace(/from-\w+-\d+/g, 'from-indigo-600').replace(/to-\w+-\d+/g, 'to-purple-600');
        emoji.textContent = '📿';
        titulo.textContent = `${novena.nome} - ${novena.diaAtual}º Dia`;
        subtitulo.textContent = novena.conteudo.titulo;
        banner.onclick = () => mostrarNovenaHoje(novena);
        return;
    }
    
    // Verificar festa do dia
    const festa = CalendarioMariano.getFestaHoje();
    if (festa) {
        banner.classList.remove('hidden');
        banner.className = banner.className.replace(/from-\w+-\d+/g, 'from-pink-600').replace(/to-\w+-\d+/g, 'to-rose-600');
        emoji.textContent = festa.tipo === 'solenidade' ? '🎊' : festa.tipo === 'festa' ? '🎉' : '⭐';
        titulo.textContent = `Hoje: ${festa.nome}`;
        subtitulo.textContent = 'Clique para ver a oração especial';
        banner.onclick = () => mostrarFestaDetalhe(festa);
        return;
    }
    
    // Mostrar próxima festa
    const proxima = CalendarioMariano.getProximaFesta();
    if (proxima && proxima.diasRestantes <= 9) {
        banner.classList.remove('hidden');
        banner.className = banner.className.replace(/from-\w+-\d+/g, 'from-amber-600').replace(/to-\w+-\d+/g, 'to-yellow-600');
        emoji.textContent = '🕯️';
        titulo.textContent = `Em ${proxima.diasRestantes} dias: ${proxima.nome}`;
        subtitulo.textContent = 'Prepare-se para esta festa!';
        banner.onclick = () => mostrarFestaDetalhe(proxima);
    }
}

function mostrarCalendario() {
    if (!window.CalendarioMariano) {
        showToast('Calendário não disponível');
        return;
    }
    // ... resto do código do calendário mantido
    showToast('📅 Calendário em breve!');
}

function mudarMesCalendario(delta) {
    mesAtualCalendario += delta;
    if (mesAtualCalendario > 12) { mesAtualCalendario = 1; anoAtualCalendario++; }
    if (mesAtualCalendario < 1) { mesAtualCalendario = 12; anoAtualCalendario--; }
}

function fecharModalCalendario() {
    const modal = document.getElementById('modal-calendario');
    if (modal) modal.remove();
}

function mostrarFestaDetalhe(festa) {
    if (!festa) return;
    showToast(`🎉 ${festa.nome}`);
}

function fecharModalFesta() {
    const modal = document.getElementById('modal-festa');
    if (modal) modal.remove();
}

function mostrarNovenaHoje(novena) {
    showToast(`📿 ${novena.nome} - Dia ${novena.diaAtual}`);
}

function fecharModalNovena() {
    const modal = document.getElementById('modal-novena');
    if (modal) modal.remove();
    showToast('✨ Oração do dia concluída!');
}

// ========================================
// 📿 TERÇO GUIADO
// ========================================

function abrirTerco() {
    if (!window.TercoGuiado) {
        showToast('Carregando terço...');
        return;
    }
    TercoGuiado.iniciar();
}

function iniciarTercoTipo(tipo) {
    if (window.TercoGuiado) TercoGuiado.iniciar(tipo);
}

function fecharEscolhaTerco() {
    const modal = document.getElementById('modal-escolha-terco');
    if (modal) modal.remove();
}

// ========================================
// 🕯️ SANTUÁRIO DE VELAS
// ========================================

function abrirSantuarioVelas() {
    if (window.SantuarioVelas) {
        SantuarioVelas.abrir();
    } else {
        showToast('Carregando santuário...');
    }
}

// ========================================
// 👥 MURAL DE INTENÇÕES
// ========================================

function abrirMuralIntencoes() {
    if (window.MuralIntencoes) {
        MuralIntencoes.abrir();
    } else {
        showToast('Carregando mural...');
    }
}

// ========================================
// 👑 TELA PREMIUM
// ========================================

function abrirTelaPremium(motivo = null) {
    if (window.TelaPremium) {
        TelaPremium.abrir(motivo);
    } else {
        showToast('Carregando...');
    }
}

// Verificar e atualizar botão premium
function atualizarBotaoPremium() {
    const btnPremium = document.getElementById('btn-premium');
    if (btnPremium && window.TelaPremium && TelaPremium.isPremium()) {
        btnPremium.innerHTML = '<span>👑</span><span>Premium ✓</span>';
        btnPremium.classList.remove('bg-gradient-to-r', 'from-yellow-500', 'to-amber-500');
        btnPremium.classList.add('bg-green-600/80');
    }
}

// ========================================
// 🔔 PWA E NOTIFICAÇÕES
// ========================================

async function initPWA() {
    if ('serviceWorker' in navigator) {
        try {
            const registration = await navigator.serviceWorker.register('sw.js');
            console.log('✅ Service Worker registrado:', registration);
        } catch (error) {
            console.log('❌ Erro ao registrar SW:', error);
        }
    }
}

// Pedir permissão de notificação
async function pedirPermissaoNotificacao() {
    if (!window.NotificationSystem) return false;
    
    const granted = await NotificationSystem.requestPermission();
    if (granted) {
        showToast('🔔 Notificações ativadas! Você receberá lembretes de oração.');
        document.getElementById('btn-notificacoes').innerHTML = '🔔 Notificações Ativas';
        document.getElementById('btn-notificacoes').classList.add('bg-green-600');
    }
    return granted;
}

// Testar notificação
function testarNotificacao() {
    if (window.NotificationSystem) {
        NotificationSystem.testNotification();
    }
}

// ========================================
// 📖 VERSÍCULO DO DIA
// ========================================

function getVersiculoDoDia() {
    if (window.NotificationSystem) {
        return NotificationSystem.getDailyVerse();
    }
    return {
        texto: "Fazei tudo o que Ele vos disser.",
        ref: "João 2:5",
        reflexao: "Confie e obedeça, mesmo sem entender os planos de Deus."
    };
}

function mostrarVersiculoDoDia() {
    const verse = getVersiculoDoDia();
    const streak = getStreak();
    
    const modal = document.createElement('div');
    modal.id = 'modal-versiculo';
    modal.className = 'fixed inset-0 z-50 flex items-center justify-center p-4';
    modal.style.background = 'rgba(0,0,0,0.9)';
    modal.innerHTML = `
        <div class="bg-gradient-to-br from-yellow-50 to-amber-100 rounded-3xl p-8 max-w-md w-full shadow-2xl transform animate-pulse-once">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">✨</div>
                <h2 class="font-cursive text-4xl text-yellow-700 mb-2">Versículo do Dia</h2>
                <p class="text-sm text-gray-500">${new Date().toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
            </div>
            
            <div class="bg-white/80 rounded-2xl p-6 mb-6 shadow-inner">
                <p class="font-serif text-xl text-gray-800 italic leading-relaxed mb-3">"${verse.texto}"</p>
                <p class="text-right text-yellow-700 font-semibold">— ${verse.ref}</p>
            </div>
            
            <div class="bg-yellow-600/10 rounded-xl p-4 mb-6">
                <p class="text-sm text-gray-700"><strong class="text-yellow-700">💭 Reflexão:</strong> ${verse.reflexao}</p>
            </div>
            
            <div class="flex items-center justify-center gap-2 mb-6 p-3 bg-gradient-to-r from-orange-500 to-yellow-500 rounded-xl text-white">
                <span class="text-2xl">🔥</span>
                <span class="font-bold text-lg">${streak} dias em oração!</span>
            </div>
            
            <button onclick="fecharModalVersiculo()" class="w-full py-4 bg-gradient-to-r from-yellow-600 to-amber-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all">
                🙏 Começar o Dia com Maria
            </button>
        </div>
    `;
    document.body.appendChild(modal);
}

function fecharModalVersiculo() {
    const modal = document.getElementById('modal-versiculo');
    if (modal) modal.remove();
}

// ========================================
// 🔥 STREAK - DIAS CONSECUTIVOS
// ========================================

function getStreak() {
    const data = localStorage.getItem('mariaStreak');
    if (!data) return 0;
    const { count, lastDate } = JSON.parse(data);
    return count || 0;
}

function updateStreak() {
    const today = new Date().toDateString();
    const data = localStorage.getItem('mariaStreak');
    let streak = { count: 1, lastDate: today };
    
    if (data) {
        const saved = JSON.parse(data);
        if (saved.lastDate === today) {
            // Já contou hoje - só atualizar UI
            const streakEl = document.getElementById('streak-count');
            if (streakEl) streakEl.textContent = saved.count;
            
            // Sincronizar com EstatisticasOracao
            if (window.EstatisticasOracao) {
                EstatisticasOracao.atualizarStreak(saved.count);
            }
            return saved.count;
        }
        
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        
        if (saved.lastDate === yesterday.toDateString()) {
            streak.count = saved.count + 1; // Dia consecutivo!
        }
        // Se não foi ontem, reseta para 1
    }
    
    localStorage.setItem('mariaStreak', JSON.stringify(streak));
    
    // Atualizar UI se existir
    const streakEl = document.getElementById('streak-count');
    if (streakEl) streakEl.textContent = streak.count;
    
    // Sincronizar com EstatisticasOracao
    if (window.EstatisticasOracao) {
        EstatisticasOracao.atualizarStreak(streak.count);
    }
    
    return streak.count;
}

// ========================================
// 🍞 TOAST NOTIFICATIONS
// ========================================

function showToast(message) {
    // Remover toast existente
    const existing = document.querySelector('.toast-notification');
    if (existing) existing.remove();
    
    const toast = document.createElement('div');
    toast.className = 'toast-notification fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-lg z-50 animate-fade-in';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}
</script>

<style>
@keyframes fade-in {
    from { opacity: 0; transform: translate(-50%, 20px); }
    to { opacity: 1; transform: translate(-50%, 0); }
}
.animate-fade-in { animation: fade-in 0.3s ease-out; }

@keyframes pulse-once {
    0% { transform: scale(0.9); opacity: 0; }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); opacity: 1; }
}
.animate-pulse-once { animation: pulse-once 0.5s ease-out; }

/* Efeito de brilho no botão de velas */
.vela-btn-glow {
    animation: vela-glow 2s ease-in-out infinite;
}

@keyframes vela-glow {
    0%, 100% { box-shadow: 0 0 5px rgba(255, 183, 77, 0.5); }
    50% { box-shadow: 0 0 15px rgba(255, 183, 77, 0.8), 0 0 25px rgba(255, 183, 77, 0.4); }
}

/* Efeito especial no botão Premium */
.premium-btn-glow {
    animation: premium-glow 2s ease-in-out infinite;
    background-size: 200% 100%;
}

@keyframes premium-glow {
    0%, 100% { 
        box-shadow: 0 0 10px rgba(251, 191, 36, 0.6), 0 0 20px rgba(251, 191, 36, 0.3);
        background-position: 0% 0%;
    }
    50% { 
        box-shadow: 0 0 20px rgba(251, 191, 36, 0.8), 0 0 40px rgba(251, 191, 36, 0.5);
        background-position: 100% 0%;
    }
}

</style>

</body>
</html>
